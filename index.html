<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<meta name="author" content="Cloud-native network functions (CNFs) best practices">
<link rel="icon" type="image/x-icon" href="assets/img/favicon.ico">
<title>CNF Best Practices</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
@import url("https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;600;700;800;900&display=swap");
@import url(https://fonts.googleapis.com/css?family=Lato:400,700,700italic,400italic);
@import url("https://fonts.googleapis.com/css2?family=Inconsolata:wght@200;300;400;500;600;700;800;900&display=swap");

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block
}

audio,
canvas,
video {
    display: inline-block
}

audio:not([controls]) {
    display: none;
    height: 0
}

[hidden],
template {
    display: none
}

script {
    display: none !important
}

html {
    font-family: sans-serif;
    -ms-text-size-adjust: 100%;
    -webkit-text-size-adjust: 100%;
    scroll-behavior: smooth;
}

body {
    margin: 0;
}

a {
    background: transparent;
}

a:focus {
    outline: thin dotted
}

a:active,
a:hover {
    outline: 0
}

h1 {
    font-size: 2em;
    margin: 0.67em 0
}

abbr[title] {
    border-bottom: 1px dotted
}

b,
strong {
    font-weight: bold
}

dfn {
    font-style: italic
}

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0
}

mark {
    background: #ff0;
    color: #000
}

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    font-size: 1em
}

pre {
    white-space: pre-wrap
}

q {
    quotes: "\201C""\201D""\2018""\2019"
}

small {
    font-size: 80%
}

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline
}

sup {
    top: -0.5em
}

sub {
    bottom: -0.25em
}

img {
    border: 0
}

svg:not(:root) {
    overflow: hidden
}

figure {
    margin: 0
}

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em
}

legend {
    border: 0;
    padding: 0
}

button,
input,
select,
textarea {
    font-family: inherit;
    font-size: 100%;
    margin: 0
}

button,
input {
    line-height: normal
}

button,
select {
    text-transform: none
}

button,
html input[type="button"],
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button;
    cursor: pointer
}

button[disabled],
html input[disabled] {
    cursor: default
}

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box;
    padding: 0
}

input[type="search"] {
    -webkit-appearance: textfield;
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box;
    box-sizing: content-box
}

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none
}

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0
}

textarea {
    overflow: auto;
    vertical-align: top
}

table {
    border-collapse: collapse;
    border-spacing: 0
}

meta.foundation-mq-small {
    font-family: "only screen and (min-width: 768px)";
    width: 768px
}

meta.foundation-mq-medium {
    font-family: "only screen and (min-width:1280px)";
    width: 1280px
}

meta.foundation-mq-large {
    font-family: "only screen and (min-width:1440px)";
    width: 1440px
}

*,
*:before,
*:after {
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box
}

html,
body {
    font-size: 100%
}

body {
    background: #fff;
    color: #222;
    padding: 0;
    margin: 0;
    font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif;
    font-weight: normal;
    font-style: normal;
    line-height: 1;
    position: relative;
    cursor: auto
}

a:hover {
    cursor: pointer
}

img,
object,
embed {
    max-width: 100%;
    height: auto
}

object,
embed {
    height: 100%
}

img {
    -ms-interpolation-mode: bicubic
}

#map_canvas img,
#map_canvas embed,
#map_canvas object,
.map_canvas img,
.map_canvas embed,
.map_canvas object {
    max-width: none !important
}

.left {
    float: left !important
}

.right {
    float: right !important
}

.text-left {
    text-align: left !important
}

.text-right {
    text-align: right !important
}

.text-center {
    text-align: center !important
}

.text-justify {
    text-align: justify !important
}

.hide {
    display: none
}

.antialiased {
    -webkit-font-smoothing: antialiased
}

img {
    display: inline-block;
    vertical-align: middle
}

textarea {
    height: auto;
    min-height: 50px
}

select {
    width: 100%
}

p.lead {
    font-size: 1.21875em;
    line-height: 1.6
}

.subheader,
.admonitionblock td.content>.title,
.audioblock>.title,
.exampleblock>.title,
.imageblock>.title,
.listingblock>.title,
.literalblock>.title,
.stemblock>.title,
.openblock>.title,
.paragraph>.title,
.quoteblock>.title,
table.tableblock>.title,
.verseblock>.title,
.videoblock>.title,
.dlist>.title,
.olist>.title,
.ulist>.title,
.qlist>.title,
.hdlist>.title {
    line-height: 1.4;
    color: #222;
    font-weight: 300;
    margin-top: 0.2em;
    margin-bottom: 0.5em
}

div,
dl,
dt,
dd,
ul,
ol,
li,
h1,
h2,
h3,
#toctitle,
.sidebarblock>.content>.title,
h4,
h5,
h6,
pre,
form,
p,
blockquote,
th,
td {
    margin: 0;
    padding: 0;
    direction: ltr;
}

div.title {
    font-weight: bold !important;
}

a {
    color: #2980b9;
    text-decoration: none;
    line-height: inherit
}

a:hover,
a:focus {
    color: #3091d1
}

a img {
    border: none
}

p {
    font-family: inherit;
    font-weight: normal;
    font-size: 1em;
    line-height: 1.5;
    margin-bottom: 1.25em;
    text-rendering: optimizeLegibility
}

p aside {
    font-size: 0.875em;
    line-height: 1.35;
    font-style: italic
}

h1,
h2,
h3,
#toctitle,
.sidebarblock>.content>.title,
h4,
h5,
h6 {
    font-family: "Roboto", sans-serif;
    font-weight: bold;
    font-style: normal;
    color: #465158;
    text-rendering: optimizeLegibility;
    margin-top: 1em;
    margin-bottom: 0.5em;
    line-height: 1.2125em
}

h1 small,
h2 small,
h3 small,
#toctitle small,
.sidebarblock>.content>.title small,
h4 small,
h5 small,
h6 small {
    font-size: 60%;
    color: #909ea7;
    line-height: 0
}

h1 {
    font-size: 2.125em
}

h2 {
    font-size: 1.6875em
}

h3,
#toctitle,
.sidebarblock>.content>.title {
    font-size: 1.375em
}

h4 {
    font-size: 1.125em
}

h5 {
    font-size: 1.125em
}

h6 {
    font-size: 1em
}

hr {
    border: solid #ddd;
    border-width: 1px 0 0;
    clear: both;
    margin: 1.25em 0 1.1875em;
    height: 0
}

em,
i {
    font-style: italic;
    line-height: inherit
}

strong,
b {
    font-weight: bold;
    line-height: inherit
}

small {
    font-size: 60%;
    line-height: inherit
}

code {
    font-family: "Inconsolata", "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace;
    font-weight: normal;
    color: #2980b9
}

ul,
ol,
dl {
    font-size: 1em;
    line-height: 1.5;
    margin-bottom: 1.25em;
    list-style-position: outside;
    font-family: inherit
}

ul,
ol {
    margin-left: 0
}

ul.no-bullet,
ol.no-bullet {
    margin-left: 0
}

ul li ul,
ul li ol {
    margin-left: 1.25em;
    margin-bottom: 0;
    font-size: 1em
}

ul.square li ul,
ul.circle li ul,
ul.disc li ul {
    list-style: inherit
}

ul.square {
    list-style-type: square
}

ul.circle {
    list-style-type: circle
}

ul.disc {
    list-style-type: disc
}

ul.no-bullet {
    list-style: none
}

ol li ul,
ol li ol {
    margin-left: 1.25em;
    margin-bottom: 0
}

dl dt {
    margin-bottom: 0.3em;
    font-weight: bold
}

dl dd {
    margin-bottom: 0.75em
}

abbr,
acronym {
    text-transform: uppercase;
    font-size: 90%;
    color: #000;
    border-bottom: 1px dotted #ddd;
    cursor: help
}

abbr {
    text-transform: none
}

blockquote {
    margin: 0 0 1.25em;
    padding: 0.5625em 1.25em 0 1.1875em;
    border-left: 1px solid #ddd
}

blockquote cite {
    display: block;
    font-size: 0.8125em;
    color: #748590
}

blockquote cite:before {
    content: "\2014 \0020"
}

blockquote cite a,
blockquote cite a:visited {
    color: #748590
}

blockquote,
blockquote p {
    line-height: 1.5;
    color: #909ea7
}

.vcard {
    display: inline-block;
    margin: 0 0 1.25em 0;
    border: 1px solid #ddd;
    padding: 0.625em 0.75em
}

.vcard li {
    margin: 0;
    display: block
}

.vcard .fn {
    font-weight: bold;
    font-size: 0.9375em
}

.vevent .summary {
    font-weight: bold
}

.vevent abbr {
    cursor: auto;
    text-decoration: none;
    font-weight: bold;
    border: none;
    padding: 0 0.0625em
}

@media only screen and (min-width: 768px) {

    h1,
    h2,
    h3,
    #toctitle,
    .sidebarblock>.content>.title,
    h4,
    h5,
    h6 {
        line-height: 1.4
    }

    h1 {
        font-size: 2.75em
    }

    h2 {
        font-size: 2.3125em
    }

    h3,
    #toctitle,
    .sidebarblock>.content>.title {
        font-size: 1.6875em
    }

    h4 {
        font-size: 1.4375em
    }
}

table {
    background: #fff;
    margin-bottom: 1.25em;
    border: solid 0 #ddd
}

table thead,
table tfoot {
    background: none;
    font-weight: bold
}

table thead tr th,
table thead tr td,
table tfoot tr th,
table tfoot tr td {
    padding: 1px 8px 1px 5px;
    font-size: 1em;
    color: #222;
    text-align: left
}

table tr th,
table tr td {
    padding: 1px 8px 1px 5px;
    font-size: 1em;
    color: #222
}

table tr.even,
table tr.alt,
table tr:nth-of-type(even) {
    background: none
}

table thead tr th,
table tfoot tr th,
table tbody tr td,
table tr td,
table tfoot tr td {
    display: table-cell;
    line-height: 1.5
}

body {
    tab-size: 4;
    word-wrap: anywhere;
    font-family: "Lato", "Roboto", "Arial", "Helvetica Neue", sans-serif;
    -moz-osx-font-smoothing: grayscale;
    -webkit-font-smoothing: antialiased
}

table {
    word-wrap: normal
}

h1,
h2,
h3,
#toctitle,
.sidebarblock>.content>.title,
h4,
h5,
h6 {
    line-height: 1.4;
    padding-top: 75px;
    margin-top: -75px;
}

/* Fix the example block css */
.exampleblock>.content>h1,
.exampleblock>.content>h2,
.exampleblock>.content>h3,
.exampleblock>.content>h4,
.exampleblock>.content>h5,
.exampleblock>.content>h6 {
    line-height: 1.4;
    padding-top: unset;
    margin-top: unset;
}

object,
svg {
    display: inline-block;
    vertical-align: middle
}

.center {
    margin-left: auto;
    margin-right: auto
}

.stretch {
    width: 100%
}

.clearfix:before,
.clearfix:after,
.float-group:before,
.float-group:after {
    content: " ";
    display: table
}

.clearfix:after,
.float-group:after {
    clear: both
}

:not(pre).nobreak {
    word-wrap: normal
}

:not(pre).nowrap {
    white-space: nowrap
}

:not(pre).pre-wrap {
    white-space: pre-wrap
}

:not(pre):not([class^=L])>code {
    font-size: 0.95em;
    font-style: normal !important;
    letter-spacing: 0;
    padding: 0;
    background-color: #f2f2f2;
    -webkit-border-radius: 6px;
    border-radius: 6px;
    line-height: inherit
}

pre {
    color: inherit;
    font-family: "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace;
    line-height: 1.2
}

pre code,
pre pre {
    color: inherit;
    font-size: inherit;
    line-height: inherit
}

pre>code {
    display: block;
    padding-right: 25px;
}

pre.nowrap,
pre.nowrap pre {
    white-space: pre;
    word-wrap: normal
}

em em {
    font-style: normal
}

strong strong {
    font-weight: normal
}

.keyseq {
    color: #333
}

kbd {
    font-family: "Inconsolata", "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace;
    display: inline-block;
    color: #000;
    font-size: 0.65em;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 1px solid #ccc;
    -webkit-border-radius: 3px;
    border-radius: 3px;
    -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em #fff inset;
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em #fff inset;
    margin: 0 0.15em;
    padding: 0.2em 0.5em;
    vertical-align: middle;
    position: relative;
    top: -0.1em;
    white-space: nowrap
}

.keyseq kbd:first-child {
    margin-left: 0
}

.keyseq kbd:last-child {
    margin-right: 0
}

.menuseq,
.menuref {
    color: #000
}

.menuseq b:not(.caret),
.menuref {
    font-weight: inherit
}

.menuseq {
    word-spacing: -0.02em
}

.menuseq b.caret {
    font-size: 1.25em;
    line-height: 0.8
}

.menuseq i.caret {
    font-weight: bold;
    text-align: center;
    width: 0.45em
}

b.button:before,
b.button:after {
    position: relative;
    top: -1px;
    font-weight: normal
}

b.button:before {
    content: "[";
    padding: 0 3px 0 2px
}

b.button:after {
    content: "]";
    padding: 0 2px 0 3px
}

#header,
#content,
#footnotes,
#footer {
    width: 100%;
    margin-left: auto;
    margin-right: auto;
    margin-top: 0;
    margin-bottom: 0;
    max-width: 62.5em;
    *zoom: 1;
    position: relative;
    padding-left: 0.9375em;
    padding-right: 0.9375em
}

#header:before,
#header:after,
#content:before,
#content:after,
#footnotes:before,
#footnotes:after,
#footer:before,
#footer:after {
    content: " ";
    display: table
}

/*#footer:before {
    vertical-align: center;
    content: url(images/redhat_standard.svg);
    width: 140px;
    font-size: 200%;
    display: flex;
    flex-direction: column;
}*/


#header:after,
#content:after,
#footnotes:after,
#footer:after {
    clear: both
}

#content {
    margin-top: 1.25em
}

#content:before {
    content: none
}

#header>h1:first-child {
    color: #111;
    margin-top: 0.1rem;
    margin-bottom: 0
}

#header>h1:first-child+#toc {
    margin-top: 8px;
    border-top: 1px solid #ddd
}

#header>h1:only-child,
body.toc2 #header>h1:nth-last-child(2) {
    border-bottom: 1px solid #ddd;
    padding-bottom: 8px
}

#header .details {
    border-bottom: 1px solid #ddd;
    line-height: 1.45;
    padding-top: 0.25em;
    padding-bottom: 0.25em;
    padding-left: 0.25em;
    color: #748590;
    display: -ms-flexbox;
    display: -webkit-flex;
    display: flex;
    -ms-flex-flow: row wrap;
    -webkit-flex-flow: row wrap;
    flex-flow: row wrap
}

#header .details span:first-child {
    margin-left: -0.125em
}

#header .details span.email a {
    color: #909ea7
}

#header .details br {
    display: none
}

#header .details br+span:before {
    content: "\00a0\2013\00a0"
}

#header .details br+span.author:before {
    content: "\00a0\22c5\00a0";
    color: #909ea7
}

#header .details br+span#revremark:before {
    content: "\00a0|\00a0"
}

#header #revnumber {
    text-transform: capitalize
}

#header #revnumber:after {
    content: "\00a0"
}

#content>h1:first-child:not([class]) {
    color: #111;
    border-bottom: 1px solid #ddd;
    padding-bottom: 8px;
    margin-top: 0;
    padding-top: 1rem;
    margin-bottom: 1.25rem
}

#toc {
    border-bottom: 1px solid #ddd;
    padding-bottom: 0.5em
}

#toc>ul {
    margin-left: 0.125em
}

#toc ul.sectlevel0>li>a {
    font-style: italic
}

#toc ul.sectlevel0 ul.sectlevel1 {
    margin: 0.5em 0
}

#toc ul {
    font-family: "Roboto", sans-serif;
    list-style-type: none
}

#toc li {
    line-height: 1.3334;
    margin-top: 0.01em
}

#toc a {
    text-decoration: none
}

#toc a:active {
    text-decoration: underline
}

#toctitle {
    color: #6c818f;
    font-size: 1.2em
}

@media only screen and (min-width: 768px) {
    #toctitle {
        font-size: 1.375em
    }

    body.toc2 {
        padding-left: 15em;
        padding-right: 0
    }

    #toc.toc2 {
        margin-top: 0 !important;
        background: #f2f2f2;
        position: fixed;
        width: 15em;
        left: 0;
        top: 0;
        border-top-width: 0 !important;
        border-bottom-width: 0 !important;
        z-index: 1000;
        padding: 1.25em 1em;
        padding-left: 3px;
        height: 100%;
        overflow: auto;
        box-shadow: 0px 0px 5px 1px rgba(0, 0, 0, 0.41);
        -webkit-box-shadow: 0px 0px 5px 1px rgba(0, 0, 0, 0.41);
    }

    #toc.toc2 #toctitle {
        margin-top: 0;
        margin-bottom: 0.8rem;
        font-size: 1.2em;
    }

    #toc.toc2>ul {
        font-size: 0.9em;
        margin-bottom: 0
    }

    #toc.toc2 ul ul {
        margin-left: 0;
        padding-left: 1em
    }

    #toc.toc2 ul.sectlevel0 ul.sectlevel1 {
        padding-left: 0;
        margin-top: 0.5em;
        margin-bottom: 0.5em
    }

    body.toc2.toc-right {
        padding-left: 0;
        padding-right: 15em
    }

    body.toc2.toc-right #toc.toc2 {
        border-right-width: 0;
        border-left: 1px solid #ddd;
        left: auto;
        right: 0
    }

    #header,
    #content,
    #footnotes,
    #footer {
        max-width: 800px;
    }

}

@media only screen and (min-width: 1280px) {
    body.toc2 {
        padding-left: 10em;
        padding-right: 0
    }

    #toc.toc2 {
        width: 20em;
    }

    #toc.toc2 #toctitle {
        font-size: 1.375em
    }

    #toc.toc2>ul {
        font-size: 0.95em
    }

    #toc.toc2 ul ul {
        padding-left: 1.25em
    }

    body.toc2.toc-right {
        padding-left: 0;
        padding-right: 20em
    }
}

#content #toc {
    border-style: solid;
    border-width: 1px;
    border-color: #d9d9d9;
    margin-bottom: 1.25em;
    padding: 1.25em;
    background: #f2f2f2;
    -webkit-border-radius: 6px;
    border-radius: 6px
}

#content #toc>:first-child {
    margin-top: 0
}

#content #toc>:last-child {
    margin-bottom: 0
}

#footer {
    background-color: #fff;
    border-top: 5px;
    padding: 1.25em
}

#footer-text {
    color: #000;
    line-height: 1.35
}

#content {
    margin-bottom: 0.625em
}

.sect1 {
    padding-bottom: 0.625em
}

@media only screen and (min-width: 768px) {
    #content {
        margin-bottom: 1.25em
    }

    .sect1 {
        padding-bottom: 1.25em
    }
}

.sect1:last-child {
    padding-bottom: 0
}

.sect1+.sect1 {
    border-top: 1px solid #ddd
}

details,
.audioblock,
.imageblock,
.literalblock,
.listingblock,
.stemblock,
.videoblock {
    margin-bottom: 1.25em
}

details>summary:first-of-type {
    cursor: pointer;
    display: list-item;
    outline: none;
    margin-bottom: 0.75em
}

.admonitionblock td.content>.title,
.audioblock>.title,
.exampleblock>.title,
.imageblock>.title,
.listingblock>.title,
.literalblock>.title,
.stemblock>.title,
.openblock>.title,
.paragraph>.title,
.quoteblock>.title,
table.tableblock>.title,
.verseblock>.title,
.videoblock>.title,
.dlist>.title,
.olist>.title,
.ulist>.title,
.qlist>.title,
.hdlist>.title {
    text-rendering: optimizeLegibility;
    text-align: left
}

table.tableblock.fit-content>caption.title {
    white-space: nowrap;
    width: 0
}

.paragraph.lead>p,
#preamble>.sectionbody>[class="paragraph"]:first-of-type p {
    font-size: 1.21875em;
    line-height: 1.6;
    color: #111
}

table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p {
    font-size: inherit
}

.admonitionblock>table {
    border-collapse: separate;
    border: 0;
    background: none;
    width: 100%
}

.admonitionblock>table td.icon {
    text-align: center;
    width: 80px
}

.admonitionblock>table td.icon img {
    max-width: none
}

.admonitionblock>table td.icon .title {
    font-weight: bold;
    font-family: "Roboto", sans-serif;
    text-transform: uppercase
}

.admonitionblock>table td.content {
    padding-left: 1.125em;
    padding-right: 1.25em;
    border-left: 1px solid #ddd;
    color: #748590;
    word-wrap: anywhere
}

.admonitionblock>table td.content>:last-child>:last-child {
    margin-bottom: 0
}

.exampleblock>.content {
    border-style: solid;
    border-width: 1px;
    border-color: #e6e6e6;
    margin-bottom: 1.25em;
    padding: 1.25em;
    background: #fff;
    -webkit-border-radius: 6px;
    border-radius: 6px
}

.exampleblock>.content>:first-child {
    margin-top: 0
}

.exampleblock>.content>:last-child {
    margin-bottom: 0
}

.sidebarblock {
    border-style: solid;
    border-width: 1px;
    border-color: #d4d4d4;
    margin-bottom: 1.25em;
    padding: 1.25em;
    background: #ededed;
    -webkit-border-radius: 6px;
    border-radius: 6px
}

.sidebarblock>:first-child {
    margin-top: 0
}

.sidebarblock>:last-child {
    margin-bottom: 0
}

.sidebarblock>.content>.title {
    color: #000;
    margin-top: 0
}

.exampleblock>.content>:last-child>:last-child,
.exampleblock>.content .olist>ol>li:last-child>:last-child,
.exampleblock>.content .ulist>ul>li:last-child>:last-child,
.exampleblock>.content .qlist>ol>li:last-child>:last-child,
.sidebarblock>.content>:last-child>:last-child,
.sidebarblock>.content .olist>ol>li:last-child>:last-child,
.sidebarblock>.content .ulist>ul>li:last-child>:last-child,
.sidebarblock>.content .qlist>ol>li:last-child>:last-child {
    margin-bottom: 0
}

.literalblock pre,
.listingblock>.content>pre {
    border: 1px solid #ccc;
    -webkit-border-radius: 6px;
    border-radius: 6px;
    overflow-x: auto;
    padding: 0.5em;
    font-size: 0.8125em
}

@media only screen and (min-width: 768px) {

    .literalblock pre,
    .listingblock>.content>pre {
        font-size: 0.90625em
    }
}

@media only screen and (min-width: 1280px) {

    .literalblock pre,
    .listingblock>.content>pre {
        font-size: 0.90625em
    }
}

.literalblock pre,
.listingblock>.content>pre:not(.highlight),
.listingblock>.content>pre[class="highlight"],
.listingblock>.content>pre[class^="highlight "] {
    background: #eee
}

.literalblock.output pre {
    color: #eee;
    background-color: inherit
}

.listingblock>.content {
    position: relative
}

.listingblock code[data-lang]:before {
    display: none;
    content: attr(data-lang);
    position: absolute;
    font-size: 0.75em;
    bottom: 0.425rem;
    right: 0.5rem;
    text-transform: uppercase;
    color: inherit;
    opacity: 0.5
}

.listingblock:hover code[data-lang]:before {
    display: block
}

.listingblock.terminal pre .command:before {
    content: attr(data-prompt);
    padding-right: 0.5em;
    color: inherit;
    opacity: 0.5
}

.listingblock.terminal pre .command:not([data-prompt]):before {
    content: "$"
}

.listingblock pre.highlightjs {
    padding: 0
}

.listingblock pre.highlightjs>code {
    -webkit-border-radius: 2px;
    border-radius: 2px;
    padding: 21px;
}

.prettyprint {
    background: #eee
}

pre.prettyprint .linenums {
    line-height: 1.2;
    margin-left: 2em
}

pre.prettyprint li {
    background: none;
    list-style-type: inherit;
    padding-left: 0
}

pre.prettyprint li code[data-lang]:before {
    opacity: 1
}

pre.prettyprint li:not(:first-child) code[data-lang]:before {
    display: none
}

table.linenotable {
    border-collapse: separate;
    border: 0;
    margin-bottom: 0;
    background: none
}

table.linenotable td[class] {
    color: inherit;
    vertical-align: top;
    padding: 0;
    line-height: inherit;
    white-space: normal
}

table.linenotable td.code {
    padding-left: 0.75em
}

table.linenotable td.linenos {
    border-right: 1px solid currentColor;
    opacity: 0.35;
    padding-right: 0.5em
}

pre.pygments .lineno {
    border-right: 1px solid currentColor;
    opacity: 0.35;
    display: inline-block;
    margin-right: 0.75em
}

pre.pygments .lineno:before {
    content: "";
    margin-right: -0.125em
}

.quoteblock {
    margin: 0 1em 1.25em 1.5em;
    display: table
}

.quoteblock:not(.excerpt)>.title {
    margin-left: -1.5em;
    margin-bottom: 0.75em
}

.quoteblock blockquote,
.quoteblock p {
    color: #909ea7;
    font-size: 1.15rem;
    line-height: 1.75;
    word-spacing: 0.1em;
    letter-spacing: 0;
    font-style: italic;
    text-align: justify
}

.quoteblock blockquote {
    margin: 0;
    padding: 0;
    border: 0
}

.quoteblock blockquote:before {
    content: "\201c";
    float: left;
    font-size: 2.75em;
    font-weight: bold;
    line-height: 0.6em;
    margin-left: -0.6em;
    color: #6c818f;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1)
}

.quoteblock blockquote>.paragraph:last-child p {
    margin-bottom: 0
}

.quoteblock .attribution {
    margin-top: 0.75em;
    margin-right: 0.5ex;
    text-align: right
}

.verseblock {
    margin: 0 1em 1.25em 1em
}

.verseblock pre {
    font-family: "Open Sans", "DejaVu Sans", sans;
    font-size: 1.15rem;
    color: #909ea7;
    font-weight: 300;
    text-rendering: optimizeLegibility
}

.verseblock pre strong {
    font-weight: 400
}

.verseblock .attribution {
    margin-top: 1.25rem;
    margin-left: 0.5ex
}

.quoteblock .attribution,
.verseblock .attribution {
    font-size: 0.8125em;
    line-height: 1.45;
    font-style: italic
}

.quoteblock .attribution br,
.verseblock .attribution br {
    display: none
}

.quoteblock .attribution cite,
.verseblock .attribution cite {
    display: block;
    letter-spacing: -0.025em;
    color: #748590
}

.quoteblock.abstract blockquote:before,
.quoteblock.excerpt blockquote:before,
.quoteblock .quoteblock blockquote:before {
    display: none
}

.quoteblock.abstract blockquote,
.quoteblock.abstract p,
.quoteblock.excerpt blockquote,
.quoteblock.excerpt p,
.quoteblock .quoteblock blockquote,
.quoteblock .quoteblock p {
    line-height: 1.6;
    word-spacing: 0
}

.quoteblock.abstract {
    margin: 0 1em 1.25em 1em;
    display: block
}

.quoteblock.abstract>.title {
    margin: 0 0 0.375em 0;
    font-size: 1.15em;
    text-align: center
}

.quoteblock.excerpt>blockquote,
.quoteblock .quoteblock {
    padding: 0 0 0.25em 1em;
    border-left: 0.25em solid #ddd
}

.quoteblock.excerpt,
.quoteblock .quoteblock {
    margin-left: 0
}

.quoteblock.excerpt blockquote,
.quoteblock.excerpt p,
.quoteblock .quoteblock blockquote,
.quoteblock .quoteblock p {
    color: inherit;
    font-size: 1.0625rem
}

.quoteblock.excerpt .attribution,
.quoteblock .quoteblock .attribution {
    color: inherit;
    text-align: left;
    margin-right: 0
}

p.tableblock:last-child {
    margin-bottom: 0
}

td.tableblock>.content {
    margin-bottom: 1.25em;
    word-wrap: anywhere
}

td.tableblock>.content>:last-child {
    margin-bottom: -1.25em
}

table.tableblock,
th.tableblock,
td.tableblock {
    border: 0 solid #ddd
}

table.grid-all>*>tr>* {
    border-width: 0
}

table.grid-cols>*>tr>* {
    border-width: 0 0
}

table.grid-rows>*>tr>* {
    border-width: 0 0
}

table.frame-all {
    border-width: 0
}

table.frame-ends {
    border-width: 0 0
}

table.frame-sides {
    border-width: 0 0
}

table.frame-none>colgroup+*>:first-child>*,
table.frame-sides>colgroup+*>:first-child>* {
    border-top-width: 0
}

table.frame-none>:last-child>:last-child>*,
table.frame-sides>:last-child>:last-child>* {
    border-bottom-width: 0
}

table.frame-none>*>tr>:first-child,
table.frame-ends>*>tr>:first-child {
    border-left-width: 0
}

table.frame-none>*>tr>:last-child,
table.frame-ends>*>tr>:last-child {
    border-right-width: 0
}

table.stripes-all tr,
table.stripes-odd tr:nth-of-type(odd),
table.stripes-even tr:nth-of-type(even),
table.stripes-hover tr:hover {
    background: none
}

th.halign-left,
td.halign-left {
    text-align: left
}

th.halign-right,
td.halign-right {
    text-align: right
}

th.halign-center,
td.halign-center {
    text-align: center
}

th.valign-top,
td.valign-top {
    vertical-align: top
}

th.valign-bottom,
td.valign-bottom {
    vertical-align: bottom
}

th.valign-middle,
td.valign-middle {
    vertical-align: middle
}

table thead th,
table tfoot th {
    font-weight: bold
}

tbody tr th {
    display: table-cell;
    line-height: 1.5;
    background: none
}

tbody tr th,
tbody tr th p,
tfoot tr th,
tfoot tr th p {
    color: #222;
    font-weight: bold
}

p.tableblock {
    font-size: 1em
}

ol {
    margin-left: 0.25em
}

ul li ol {
    margin-left: 0
}

dl dd {
    margin-left: 1.125em
}

dl dd:last-child,
dl dd:last-child>:last-child {
    margin-bottom: 0
}

ol>li p,
ul>li p,
ul dd,
ol dd,
.olist .olist,
.ulist .ulist,
.ulist .olist,
.olist .ulist {
    margin-bottom: 0.625em
}

ul.checklist,
ul.none,
ol.none,
ul.no-bullet,
ol.no-bullet,
ol.unnumbered,
ul.unstyled,
ol.unstyled {
    list-style-type: none
}

ul.no-bullet,
ol.no-bullet,
ol.unnumbered {
    margin-left: 0.625em
}

ul.unstyled,
ol.unstyled {
    margin-left: 0
}

ul.checklist {
    margin-left: 0.625em
}

ul.checklist li>p:first-child>.fa-square-o:first-child,
ul.checklist li>p:first-child>.fa-check-square-o:first-child {
    width: 1.25em;
    font-size: 0.8em;
    position: relative;
    bottom: 0.125em
}

ul.checklist li>p:first-child>input[type="checkbox"]:first-child {
    margin-right: 0.25em
}

ul.inline {
    display: -ms-flexbox;
    display: -webkit-box;
    display: flex;
    -ms-flex-flow: row wrap;
    -webkit-flex-flow: row wrap;
    flex-flow: row wrap;
    list-style: none;
    margin: 0 0 0.625em -1.25em
}

ul.inline>li {
    margin-left: 1.25em
}

.unstyled dl dt {
    font-weight: normal;
    font-style: normal
}

ol.arabic {
    list-style-type: decimal
}

ol.decimal {
    list-style-type: decimal-leading-zero
}

ol.loweralpha {
    list-style-type: lower-alpha
}

ol.upperalpha {
    list-style-type: upper-alpha
}

ol.lowerroman {
    list-style-type: lower-roman
}

ol.upperroman {
    list-style-type: upper-roman
}

ol.lowergreek {
    list-style-type: lower-greek
}

.hdlist>table,
.colist>table {
    border: 0;
    background: none
}

.hdlist>table>tbody>tr,
.colist>table>tbody>tr {
    background: none
}

td.hdlist1,
td.hdlist2 {
    vertical-align: top;
    padding: 0 0.625em
}

td.hdlist1 {
    font-weight: bold;
    padding-bottom: 1.25em
}

td.hdlist2 {
    word-wrap: anywhere
}

.literalblock+.colist,
.listingblock+.colist {
    margin-top: -0.5em
}

.colist td:not([class]):first-child {
    padding: 0.4em 0.75em 0 0.75em;
    line-height: 1;
    vertical-align: top
}

.colist td:not([class]):first-child img {
    max-width: none
}

.colist td:not([class]):last-child {
    padding: 0.25em 0
}

.thumb,
.th {
    line-height: 0;
    display: inline-block;
    border: solid 4px #fff;
    -webkit-box-shadow: 0 0 0 1px #ddd;
    box-shadow: 0 0 0 1px #ddd
}

.imageblock.left {
    margin: 0.25em 0.625em 1.25em 0
}

.imageblock.right {
    margin: 0.25em 0 1.25em 0.625em
}

.imageblock>.title {
    margin-bottom: 0
}

.imageblock.thumb,
.imageblock.th {
    border-width: 6px
}

.imageblock.thumb>.title,
.imageblock.th>.title {
    padding: 0 0.125em
}

.image.left,
.image.right {
    margin-top: 0.25em;
    margin-bottom: 0.25em;
    display: inline-block;
    line-height: 0
}

.image.left {
    margin-right: 0.625em
}

.image.right {
    margin-left: 0.625em
}

a.image {
    text-decoration: none;
    display: inline-block
}

a.image object {
    pointer-events: none
}

sup.footnote,
sup.footnoteref {
    font-size: 0.875em;
    position: static;
    vertical-align: super
}

sup.footnote a,
sup.footnoteref a {
    text-decoration: none
}

sup.footnote a:active,
sup.footnoteref a:active {
    text-decoration: underline
}

#footnotes {
    padding-top: 0.75em;
    padding-bottom: 0.75em;
    margin-bottom: 0.625em
}

#footnotes hr {
    width: 20%;
    min-width: 6.25em;
    margin: -0.25em 0 0.75em 0;
    border-width: 1px 0 0 0
}

#footnotes .footnote {
    padding: 0 0.375em 0 0.225em;
    line-height: 1.3334;
    font-size: 0.875em;
    margin-left: 1.2em;
    margin-bottom: 0.2em
}

#footnotes .footnote a:first-of-type {
    font-weight: bold;
    text-decoration: none;
    margin-left: -1.05em
}

#footnotes .footnote:last-of-type {
    margin-bottom: 0
}

#content #footnotes {
    margin-top: -0.625em;
    margin-bottom: 0;
    padding: 0.75em 0
}

.gist .file-data>table {
    border: 0;
    background: #fff;
    width: 100%;
    margin-bottom: 0
}

.gist .file-data>table td.line-data {
    width: 99%
}

div.unbreakable {
    page-break-inside: avoid
}

.big {
    font-size: larger
}

.small {
    font-size: smaller
}

.underline {
    text-decoration: underline
}

.overline {
    text-decoration: overline
}

.line-through {
    text-decoration: line-through
}

.aqua {
    color: #00bfbf
}

.aqua-background {
    background-color: #00fafa
}

.black {
    color: #000
}

.black-background {
    background-color: #000
}

.blue {
    color: #0000bf
}

.blue-background {
    background-color: #0000fa
}

.fuchsia {
    color: #bf00bf
}

.fuchsia-background {
    background-color: #fa00fa
}

.gray {
    color: #606060
}

.gray-background {
    background-color: #7d7d7d
}

.green {
    color: #006000
}

.green-background {
    background-color: #007d00
}

.lime {
    color: #00bf00
}

.lime-background {
    background-color: #00fa00
}

.maroon {
    color: #600000
}

.maroon-background {
    background-color: #7d0000
}

.navy {
    color: #000060
}

.navy-background {
    background-color: #00007d
}

.olive {
    color: #606000
}

.olive-background {
    background-color: #7d7d00
}

.purple {
    color: #600060
}

.purple-background {
    background-color: #7d007d
}

.red {
    color: #bf0000
}

.red-background {
    background-color: #fa0000
}

.silver {
    color: #909090
}

.silver-background {
    background-color: #bcbcbc
}

.teal {
    color: #006060
}

.teal-background {
    background-color: #007d7d
}

.white {
    color: #bfbfbf
}

.white-background {
    background-color: #fafafa
}

.yellow {
    color: #bfbf00
}

.yellow-background {
    background-color: #fafa00
}

span.icon>.fa {
    cursor: default
}

a span.icon>.fa {
    cursor: inherit
}

.admonitionblock td.icon [class^="fa icon-"] {
    font-size: 2.5em;
    text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);
    cursor: default
}

.admonitionblock td.icon .icon-note:before {
    content: "\f05a";
    color: white
}

.admonitionblock td.icon .icon-tip:before {
    content: "\f0eb";
    text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8);
    color: white
}

.admonitionblock td.icon .icon-warning:before {
    content: "\f071";
    color: white
}

.admonitionblock td.icon .icon-caution:before {
    content: "\f06d";
    color: white
}

.admonitionblock td.icon .icon-important:before {
    content: "\f06a";
    color: white
}

.conum[data-value] {
    display: inline-block;
    color: #fff !important;
    background-color: #000;
    -webkit-border-radius: 50%;
    border-radius: 50%;
    text-align: center;
    font-size: 0.75em;
    width: 1.67em;
    height: 1.67em;
    line-height: 1.67em;
    font-family: "Open Sans", "DejaVu Sans", sans-serif;
    font-style: normal;
    font-weight: bold
}

.conum[data-value] * {
    color: #fff !important
}

.conum[data-value]+b {
    display: none
}

.conum[data-value]:after {
    content: attr(data-value)
}

pre .conum[data-value] {
    position: relative;
    top: -0.125em
}

b.conum * {
    color: inherit !important
}

.conum:not([data-value]):empty {
    display: none
}

h4 {
    color: #6c818f
}

.literalblock>.content>pre,
.listingblock>.content>pre {
    -webkit-border-radius: 6px;
    border-radius: 6px;
    margin-left: 2em;
    margin-right: 2em
}

.admonitionblock {
    margin-left: 2em;
    margin-right: 2em
}

.admonitionblock>table {
    border: 1px solid #609060;
    border-top-width: 1.5em;
    background-color: #e9ffe9;
    border-collapse: separate;
    -webkit-border-radius: 0;
    border-radius: 0
}

.admonitionblock>table td.icon {
    padding-top: .5em;
    padding-bottom: .5em
}

.admonitionblock>table td.content {
    padding: .5em 1em;
    color: #000;
    font-size: .9em;
    border-left: none
}

.sidebarblock {
    background-color: #e8ecef;
    border-color: #ccc
}

.sidebarblock>.content>.title {
    color: #000
}

table.tableblock.grid-all {
    border-collapse: collapse;
    -webkit-border-radius: 0;
    border-radius: 0
}

table.tableblock.grid-all th.tableblock,
table.tableblock.grid-all td.tableblock {
    border-bottom: 1px solid #aaa
}

#footer {
    background-color: #fff;
    border-top: 2px solid #f3f3f3;
    padding: 1em
}

#footer-text {
    font-size: 0.8em;
    text-align: left;
    padding-top: 10px;
}

#toc.toc2 {
    font-family: "Lato", "Roboto", "Arial", "Helvetica Neue", sans-serif;
    padding: 0;
}

#toc.toc2 #toctitle {
    padding: 1em 1em;
    text-align: left;
    font-family: "Roboto", sans-serif;
    color: #465158;
    background: #f3f3f3;
    text-transform: uppercase;
    font-size: medium;
    border-bottom: 1px solid #dedede;
}

/*#toc.toc2 #toctitle::before {
    vertical-align: left;
    content: url(images/redhat_standard.svg);
    width: 140px;
    font-size: 200%;
    margin-left: 45px;
    display: flex;
    flex-direction: column;
}*/

#toc.toc2 a {
    display: block;
    color: #d9d9d9;
    padding: 0.25em 1em
}

#toc.toc2 a:hover,
#toc.toc2 a:focus {
    background: #dedede
}

#toc.toc2 ul {
    font-family: "Lato", "Roboto", "Arial", "Helvetica Neue", sans-serif
}

#toc.toc2 ul.sectlevel1 a {
    font-weight: bold;
    color: #465158
}

#toc.toc2 ul.sectlevel1 a {
    border-right: 3px solid transparent;
}
#toc.toc2 ul.sectlevel1 a:hover,
#toc.toc2 ul.sectlevel1 a:focus {
    color: #000;
    border-right: 3px solid #8b8b8b;
}

#toc.toc2 ul.sectlevel2,
#toc.toc2 ul.sectlevel3,
#toc.toc2 ul.sectlevel4,
#toc.toc2 ul.sectlevel5,
#toc.toc2 ul.sectlevel6 {
    padding: 0
}

#toc.toc2 ul.sectlevel2 a,
#toc.toc2 ul.sectlevel3 a,
#toc.toc2 ul.sectlevel4 a,
#toc.toc2 ul.sectlevel5 a,
#toc.toc2 ul.sectlevel6 a {
    font-weight: normal;
    color: #465158
}

#toc.toc2 ul.sectlevel2.sectlevel2 a,
#toc.toc2 ul.sectlevel3.sectlevel2 a,
#toc.toc2 ul.sectlevel4.sectlevel2 a,
#toc.toc2 ul.sectlevel5.sectlevel2 a,
#toc.toc2 ul.sectlevel6.sectlevel2 a {
    padding-left: 2em
}

#toc.toc2 ul.sectlevel2.sectlevel3 a,
#toc.toc2 ul.sectlevel3.sectlevel3 a,
#toc.toc2 ul.sectlevel4.sectlevel3 a,
#toc.toc2 ul.sectlevel5.sectlevel3 a,
#toc.toc2 ul.sectlevel6.sectlevel3 a {
    padding-left: 3em
}

#toc.toc2 ul.sectlevel2.sectlevel4 a,
#toc.toc2 ul.sectlevel3.sectlevel4 a,
#toc.toc2 ul.sectlevel4.sectlevel4 a,
#toc.toc2 ul.sectlevel5.sectlevel4 a,
#toc.toc2 ul.sectlevel6.sectlevel4 a {
    padding-left: 4em
}

#toc.toc2 ul.sectlevel2.sectlevel5 a,
#toc.toc2 ul.sectlevel3.sectlevel5 a,
#toc.toc2 ul.sectlevel4.sectlevel5 a,
#toc.toc2 ul.sectlevel5.sectlevel5 a,
#toc.toc2 ul.sectlevel6.sectlevel5 a {
    padding-left: 5em
}

#toc.toc2 ul.sectlevel2.sectlevel6 a,
#toc.toc2 ul.sectlevel3.sectlevel6 a,
#toc.toc2 ul.sectlevel4.sectlevel6 a,
#toc.toc2 ul.sectlevel5.sectlevel6 a,
#toc.toc2 ul.sectlevel6.sectlevel6 a {
    padding-left: 6em
}

:not(pre):not([class^="L"])>code {
    font-size: 0.95em;
    font-style: normal !important;
    letter-spacing: 0;
    padding: 0px 4px;
    background-color: #f6f6f6;
    -webkit-border-radius: 4px;
    border-radius: 4px;
    line-height: inherit;
    border: solid #ddd7d7 1px;
    color: #465158;
}

.admonitionblock {
    margin: 0
}

.admonitionblock.note>table {
    background-color: #e7f2fa
}

.admonitionblock.note>table td.icon {
    background-color: #3e97d7;
    width: 100%;
    text-align: left;
    padding-left: 2em
}

.admonitionblock.note>table td.icon i.icon-note::before {
    color: white
}

.admonitionblock.note>table td.icon i.icon-note::after {
    color: white;
    content: "Note";
    padding-left: 1em;
    font-family: "Lato", "Roboto", "Arial", "Helvetica Neue", sans-serif;
    font-size: 0.9em;
    font-weight: bold
}

.admonitionblock.tip>table {
    background-color: #e9ffe9
}

.admonitionblock.tip>table td.icon {
    background-color: #00b600;
    width: 100%;
    text-align: left;
    padding-left: 2em
}

.admonitionblock.tip>table td.icon i.icon-tip::before {
    color: white
}

.admonitionblock.tip>table td.icon i.icon-tip::after {
    color: white;
    content: "Tip";
    padding-left: 1em;
    font-family: "Lato", "Roboto", "Arial", "Helvetica Neue", sans-serif;
    font-size: 0.9em;
    font-weight: bold
}

.admonitionblock.caution>table {
    background-color: #ffe3ca
}

.admonitionblock.caution>table td.icon {
    background-color: #fd7700;
    width: 100%;
    text-align: left;
    padding-left: 2em
}

.admonitionblock.caution>table td.icon i.icon-caution::before {
    color: white
}

.admonitionblock.caution>table td.icon i.icon-caution::after {
    color: white;
    content: "Caution";
    padding-left: 1em;
    font-family: "Lato", "Roboto", "Arial", "Helvetica Neue", sans-serif;
    font-size: 0.9em;
    font-weight: bold
}

.admonitionblock.warning>table {
    background-color: #ffd6ca
}

.admonitionblock.warning>table td.icon {
    background-color: #fd3900;
    width: 100%;
    text-align: left;
    padding-left: 2em
}

.admonitionblock.warning>table td.icon i.icon-warning::before {
    color: white
}

.admonitionblock.warning>table td.icon i.icon-warning::after {
    color: white;
    content: "Warning";
    padding-left: 1em;
    font-family: "Lato", "Roboto", "Arial", "Helvetica Neue", sans-serif;
    font-size: 0.9em;
    font-weight: bold
}

.admonitionblock.important>table {
    background-color: #ffedcc
}

.admonitionblock.important>table td.icon {
    background-color: orange;
    width: 100%;
    text-align: left;
    padding-left: 2em
}

.admonitionblock.important>table td.icon i.icon-important::before {
    color: white
}

.admonitionblock.important>table td.icon i.icon-important::after {
    color: white;
    content: "Important";
    padding-left: 1em;
    font-family: "Lato", "Roboto", "Arial", "Helvetica Neue", sans-serif;
    font-size: 0.9em;
    font-weight: bold
}

.admonitionblock>table {
    border: none
}

.admonitionblock>table td {
    display: inline-block;
    width: 100%;
    font-size: 8px
}

.tableblock code {
    border: none;
}

.literalblock>.content>pre,
.listingblock>.content>pre {
    margin: 0
}

.literalblock pre,
.listingblock>.content>pre {
    background: #f8f8f8;
    padding: 15px;
}

@media only screen and (min-width: 768px) {
    #toc.toc2 {
        padding: 0;
        background: #f3f3f3;
    }

    /*#toc.toc2 #toctitle::before {
        margin-left: -0.5em
    }*/
}

.ulist:not(.checklist) ul,
.ulist:not(.checklist) ol {
    margin-left: 1.5em
}

/*.ulist:not(.checklist) ul li>p,
.ulist:not(.checklist) ol li>p {
    padding-left: 0.5em
}*/

.olist ol {
    margin-left: 2em
}

i.conum[data-value] {
    background-color: #465158
}

#content h1:hover>a.anchor,
#content h1>a.anchor:hover,
h2:hover>a.anchor,
h2>a.anchor:hover,
h3:hover>a.anchor,
#toctitle:hover>a.anchor,
.sidebarblock>.content>.title:hover>a.anchor,
h3>a.anchor:hover,
#toctitle>a.anchor:hover,
.sidebarblock>.content>.title>a.anchor:hover,
h4:hover>a.anchor,
h4>a.anchor:hover,
h5:hover>a.anchor,
h5>a.anchor:hover,
h6:hover>a.anchor,
h6>a.anchor:hover {
    visibility: visible
}

#content h1>a.link,
h2>a.link,
h3>a.link,
#toctitle>a.link,
.sidebarblock>.content>.title>a.link,
h4>a.link,
h5>a.link,
h6>a.link {
    color: #465158;
    text-decoration: none
}

#content h1>a.link:hover,
h2>a.link:hover,
h3>a.link:hover,
#toctitle>a.link:hover,
.sidebarblock>.content>.title>a.link:hover,
h4>a.link:hover,
h5>a.link:hover,
h6>a.link:hover {
    color: #3b444a
}

#content h1>a.link:hover:after,
h2>a.link:hover:after,
h3>a.link:hover:after,
#toctitle>a.link:hover:after,
.sidebarblock>.content>.title>a.link:hover:after,
h4>a.link:hover:after,
h5>a.link:hover:after,
h6>a.link:hover:after {
    content: "\f0c1";
    font-family: 'FontAwesome';
    font-size: 0.65em;
    display: inline-block;
    color: #3091d1;
    margin-left: 0.5em
}

@media only screen and (max-width: 767px) {
    #toc.toc2 {
        padding: 0;
        background: #f3f3f3;
    }

    #toc.toc2 #toctitle::before {
        display: none;
    }

    #toc.toc2 #toctitle {
        display: none;
    }

}

/* Top navigation */
.navbar {
    background-color: #333;
    overflow: hidden;
    padding: 1em;
    position: fixed;
    width: 100%;
    top: 0;
    color: #fff !important;
    font-weight: bold;
    text-transform: uppercase;
    height: 60px;
    z-index: 9999999;
    left: 0;
    filter: drop-shadow(-3px -13px 23px #000);
    transform: translateY(-100px);
    transition: 0.4s;
}

.navbar a {
    color: #fff !important;
}

.show {
    transform: translateY(0);
}

/* Copy code */
div.content>pre>button {
    display: none;
}*

div.listingblock>div>pre.rouge>button {
    display: unset;
    border: 0;
    font-size: 0.6em;
    padding: 5px;
    text-transform: uppercase;
    font-weight: 400;
    position: absolute;
    top: 0.425rem;
    right: 0.5rem;
    background: #dedede;
    color: inherit;
    opacity: 0.5;
    border-radius: 4px;
}

/* GitHub link */
.github-corner:hover .octo-arm {
    animation: octocat-wave 560ms ease-in-out
}

@keyframes octocat-wave {
    0%,
    100% {
        transform: rotate(0)
    }

    20%,
    60% {
        transform: rotate(-25deg)
    }

    40%,
    80% {
        transform: rotate(10deg)
    }
}

@media (max-width:500px) {
    .github-corner:hover .octo-arm {
        animation: none
    }

    .github-corner .octo-arm {
        animation: octocat-wave 560ms ease-in-out
    }
}

/* Active TOC item tweak */
.active {
    border-right: 3px solid #2e2e2e !important;
    font-weight: bold;
    color: #465158;
    background: #dedede;
    text-decoration: none;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0" />
<script src="./assets/js/jquery.min.js"></script>
</head>
<body id="cnf-best-practices" class="article toc2 toc-left">
<!-- Navbar -->
<div class="paragraph navbar">
    <p><a href="#"><span class="image"><img src="assets/img/logo.svg" alt="Home" width="30"></span> | CNF Best Practices</a>
    </p>
</div>
<div id="header">
<h1>CNF Best Practices</h1>
<div class="details">
<span id="author" class="author">Cloud-native network functions (CNFs) best practices</span><br>
<span id="revnumber">version v2,</span>
<span id="revdate">2023</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">CNF Best Practices vv2</div>
<ul class="sectlevel1">
<li><a href="#cnf-best-practices-foreword">1. Foreword</a></li>
<li><a href="#cnf-best-practices-openshift-platform">2. Developing Containers and Operators for the OpenShift Container Platform (OCP)</a>
<ul class="sectlevel2">
<li><a href="#cnf-best-practices-helm">2.1. Helm v3</a></li>
<li><a href="#cnf-best-practices-k8s">2.2. Kubernetes</a></li>
<li><a href="#cnf-best-practices-cni-ovn">2.3. CNI-OVN</a></li>
<li><a href="#cnf-best-practices-csi">2.4. Container storage (CSI)</a></li>
<li><a href="#cnf-best-practices-block-storage">2.5. Block storage</a></li>
<li><a href="#cnf-best-practices-ephemeral-storage">2.6. Ephemeral storage</a></li>
<li><a href="#cnf-best-practices-local-storage">2.7. Local storage</a></li>
<li><a href="#cnf-best-practices-container-runtime">2.8. Container runtime</a></li>
<li><a href="#cnf-best-practices-cpu-manager-pinning">2.9. CPU manager/pinning</a></li>
<li><a href="#cnf-best-practices-host-os">2.10. Container host operating system</a></li>
<li><a href="#cnf-best-practices-ubi">2.11. Red Hat Universal Base Images</a>
<ul class="sectlevel3">
<li><a href="#cnf-best-practices-base-images">2.11.1. Base Images</a>
<ul class="sectlevel4">
<li><a href="#cnf-best-practices-runtime-languages">2.11.1.1. Runtime Languages</a></li>
<li><a href="#cnf-best-practices-complementary-packages">2.11.1.2. Complementary packages</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#cnf-best-practices-pod-security">2.12. Pod security</a></li>
<li><a href="#cnf-best-practices-ci-cd">2.13. CI/CD framework</a></li>
<li><a href="#cnf-best-practices-k8s-api-versions">2.14. Kubernetes API versions</a></li>
<li><a href="#cnf-best-practices-ovn-kubernetes-cni">2.15. OVN-Kubernetes CNI</a></li>
<li><a href="#cnf-best-practices-user-plane-functions">2.16. User plane functions</a>
<ul class="sectlevel3">
<li><a href="#cnf-best-practices-performance-addon-operator-pao">2.16.1. Node Tuning Operator</a></li>
</ul>
</li>
<li><a href="#cnf-best-practices-huge-pages">2.17. Huge pages</a></li>
<li><a href="#cnf-best-practices-cpu-isolation">2.18. CPU isolation</a></li>
<li><a href="#cnf-best-practices-topology-manager-and-numa-awareness">2.19. Topology Manager and NUMA awareness</a></li>
<li><a href="#cnf-best-practices-ipv4-&-ipv6">2.20. IPv4 &amp; IPv6</a></li>
<li><a href="#cnf-best-practices-vrfs-aka-routing-instances">2.21. VRFs (aka routing instances)</a></li>
<li><a href="#cnf-best-practices-ports-reserved-by-openshift">2.22. Ports reserved by OpenShift</a></li>
<li><a href="#cnf-best-practices-user-plane-cnfs">2.23. Handling user-plane CNFs</a></li>
</ul>
</li>
<li><a href="#cnf-best-practices-developer-guide">3. CNF developer guide</a>
<ul class="sectlevel2">
<li><a href="#cnf-best-practices-preface">3.1. Preface</a></li>
<li><a href="#cnf-best-practices-goal">3.2. Goal</a></li>
<li><a href="#cnf-best-practices-non-goal">3.3. Non-goal</a></li>
<li><a href="#cnf-best-practices-refactoring">3.4. Refactoring</a></li>
<li><a href="#cnf-best-practices-cnf-security">3.5. CNF security</a>
<ul class="sectlevel3">
<li><a href="#cnf-best-practices-avoid-accessing-resource-on-host">3.5.1. Avoid accessing resource on host</a></li>
<li><a href="#cnf-best-practices-avoid-mounting-host-directories-as-volumes">3.5.2. Avoid mounting host directories as volumes</a></li>
<li><a href="#cnf-best-practices-avoid-the-host-network-namespace">3.5.3. Avoid the host network namespace</a></li>
</ul>
</li>
<li><a href="#cnf-best-practices-linux-capabilities">3.6. Linux capabilities</a>
<ul class="sectlevel3">
<li><a href="#cnf-best-practices-default-capabilities">3.6.1. DEFAULT capabilities</a></li>
<li><a href="#cnf-best-practices-ipc_lock">3.6.2. IPC_LOCK</a></li>
<li><a href="#cnf-best-practices-net_admin">3.6.3. NET_ADMIN</a></li>
<li><a href="#cnf-best-practices-avoid-sys_admin">3.6.4. Avoid SYS_ADMIN</a></li>
<li><a href="#cnf-best-practices-sys_nice">3.6.5. SYS_NICE</a></li>
<li><a href="#cnf-best-practices-sys_ptrace">3.6.6. SYS_PTRACE</a></li>
</ul>
</li>
<li><a href="#cnf-best-practices-openshift-operations">3.7. Operations that shall be executed by OpenShift</a>
<ul class="sectlevel3">
<li><a href="#cnf-best-practices-mtu-setting">3.7.1. Setting the MTU</a></li>
<li><a href="#cnf-best-practices-link-state-modification">3.7.2. Modifying link state</a></li>
<li><a href="#cnf-best-practices-ip/mac-address-assignment">3.7.3. Assigning IP/MAC addresses</a></li>
<li><a href="#cnf-best-practices-manipulate-pods-route-table">3.7.4. Manipulating pod route tables</a></li>
<li><a href="#cnf-best-practices-sr/iov-vf-setting">3.7.5. Setting SR/IOV VFs</a></li>
<li><a href="#cnf-best-practices-multicast">3.7.6. Configuring multicast</a></li>
<li><a href="#cnf-best-practices-operations-that-can-not-be-executed-by-openshift">3.7.7. Operations that can not be executed by OpenShift</a></li>
<li><a href="#cnf-best-practices-analyzing-your-application">3.7.8. Analyzing your application</a>
<ul class="sectlevel4">
<li><a href="#cnf-best-practices-example">3.7.8.1. Finding the capabilities that an application needs</a></li>
</ul>
</li>
<li><a href="#cnf-best-practices-cnf-network-security">3.7.9. Securing CNF networks</a></li>
<li><a href="#cnf-best-practices-secrets-management">3.7.10. Managing secrets</a></li>
<li><a href="#cnf-best-practices-scc-permissions-for-an-application">3.7.11. Setting SCC permissions for applications</a></li>
</ul>
</li>
<li><a href="#cnf-best-practices-expectations-permissions">3.8. Cloud-native function expectations and permissions</a>
<ul class="sectlevel3">
<li><a href="#cnf-best-practices-cloud-native-design-best-practices">3.8.1. Cloud-native design best practices</a>
<ul class="sectlevel4">
<li><a href="#cnf-best-practices-high-level-cnf-expectations">3.8.1.1. High-level CNF expectations</a></li>
<li><a href="#cnf-best-practices-pod-permissions">3.8.1.2. Pod permissions</a></li>
<li><a href="#cnf-best-practices-logging">3.8.1.3. Logging</a></li>
<li><a href="#cnf-best-practices-monitoring">3.8.1.4. Monitoring</a></li>
<li><a href="#cnf-best-practices-cpu-allocation">3.8.1.5. CPU allocation</a></li>
<li><a href="#cnf-best-practices-memory-allocation">3.8.1.6. Memory allocation</a></li>
<li><a href="#cnf-best-practices-pods">3.8.1.7. Pods</a>
<ul class="sectlevel5">
<li><a href="#cnf-best-practices-pod-interaction/configuration">3.8.1.7.1. Pod interaction and configuration</a></li>
<li><a href="#cnf-best-practices-pod-exit-status">3.8.1.7.2. Pod exit status</a></li>
<li><a href="#cnf-best-practices-graceful-termination">3.8.1.7.3. Graceful termination</a></li>
<li><a href="#cnf-best-practices-pod-resource-profiles">3.8.1.7.4. Pod resource profiles</a></li>
<li><a href="#cnf-best-practices-storage:-emptydir">3.8.1.7.5. Storage: emptyDir</a></li>
<li><a href="#cnf-best-practices-liveness-readiness-and-startup-probes">3.8.1.7.6. Liveness readiness and startup probes</a></li>
<li><a href="#cnf-best-practices-affinity/anti-affinity">3.8.1.7.7. Affinity and anti-affinity</a></li>
<li><a href="#cnf-best-practices-upgrade-expectations">3.8.1.7.8. Upgrade expectations</a></li>
<li><a href="#cnf-best-practices-taints-and-tolerations">3.8.1.7.9. Taints and tolerations</a></li>
<li><a href="#cnf-best-practices-requests/limits">3.8.1.7.10. Requests/Limits</a></li>
<li><a href="#cnf-best-practices-use-imagepullpolicy-if-not-present">3.8.1.7.11. Use imagePullPolicy: IfNotPresent</a></li>
<li><a href="#cnf-best-practices-automount-services-for-pods">3.8.1.7.12. Automount services for pods</a></li>
<li><a href="#cnf-best-practices-disruption-budgets">3.8.1.7.13. Disruption budgets</a></li>
<li><a href="#cnf-best-practices-no-naked-pods">3.8.1.7.14. No naked pods</a></li>
<li><a href="#cnf-best-practices-image-tagging">3.8.1.7.15. Image tagging</a></li>
<li><a href="#cnf-best-practices-one-process-per-container">3.8.1.7.16. One process per container</a></li>
<li><a href="#cnf-best-practices-init-containers">3.8.1.7.17. init containers</a></li>
</ul>
</li>
<li><a href="#cnf-best-practices-security-rbac">3.8.1.8. Security and role-based access control</a></li>
<li><a href="#cnf-best-practices-custom-role-to-access-application-crds">3.8.1.9. Custom role to access application CRDs</a></li>
<li><a href="#cnf-best-practices-multus">3.8.1.10. MULTUS</a></li>
<li><a href="#cnf-best-practices-multus-macvlan">3.8.1.11. MULTUS SR-IOV / MACVLAN</a></li>
<li><a href="#cnf-best-practices-sr-iov-interface-settings">3.8.1.12. SR-IOV interface settings</a></li>
<li><a href="#cnf-best-practices-attaching-the-vf-to-a-pod">3.8.1.13. Attaching the VF to a pod</a></li>
<li><a href="#cnf-best-practices-discovering-sr-iov-devices-properties-from-the-application">3.8.1.14. Discovering SR-IOV devices properties from the application</a></li>
<li><a href="#cnf-best-practices-numa-awareness">3.8.1.15. NUMA awareness</a></li>
<li><a href="#cnf-best-practices-platform-upgrade">3.8.1.16. Platform upgrade</a></li>
<li><a href="#cnf-best-practices-openshift-virtualization-kubevirt">3.8.1.17. OpenShift virtualization and CNV best practices</a>
<ul class="sectlevel5">
<li><a href="#cnf-best-practices-vm-image-import-recommendations-cdi">3.8.1.17.1. VM image import recommendations (CDI)</a></li>
<li><a href="#cnf-best-practices-working-with-large-vm-disk-images">3.8.1.17.2. Working with large VM disk images</a></li>
</ul>
</li>
<li><a href="#cnf-best-practices-operator-best-practices">3.8.1.18. Operator best practices</a>
<ul class="sectlevel5">
<li><a href="#cnf-best-practices-cnf-operator-requirements">3.8.1.18.1. CNF Operator requirements</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#cnf-best-practices-requirements-cnf-reqs">3.9. Requirements for CNF</a>
<ul class="sectlevel3">
<li><a href="#cnf-best-practices-image-standards">3.9.1. Image standards</a></li>
<li><a href="#cnf-best-practices-universal-base-image-information">3.9.2. Universal Base Image information</a></li>
<li><a href="#cnf-best-practices-application-dns-configuration-requirements">3.9.3. Application DNS configuration requirements</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#cnf-best-practices-copyright">Copyright</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="cnf-best-practices-foreword"><a class="link" href="#cnf-best-practices-foreword">1. Foreword</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This Cloud Native Function (CNF) requirements document was originally created in 2020 by Verizon with assistance from Red Hat.
Verizon&#8217;s vision of an open collaborative process to create industry standards for cloud-native network functions led this document to be where it is today.
Over many iterations, and based on lessons learned and feature improvements in the areas of security, lifecycle management, networking, and many other components, the document has matured into its current state.</p>
</div>
<div class="paragraph">
<p>Many thanks to the team at Verizon for kick-starting this effort and for the many contributions Verizon has made to the document over the years.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cnf-best-practices-openshift-platform"><a class="link" href="#cnf-best-practices-openshift-platform">2. Developing Containers and Operators for the OpenShift Container Platform (OCP)</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Review the following information to learn more about developing Containers and Operators for the OpenShift Container Platform (OCP) in compliance with Red Hat certification requirements:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://redhat-connect.gitbook.io/certified-operator-guide/">Building Operator that meets the Red Hat certification criteria</a></p>
</li>
<li>
<p><a href="https://redhat-connect.gitbook.io/partner-guide-for-red-hat-openshift-and-container/">Partner guide for Red Hat Container, Operator, Helm Chart certifications</a></p>
</li>
<li>
<p><a href="https://redhat-connect.gitbook.io/openshift-badges/badges/cloud-native-network-functions-cnf/overview">Partner guide for Red Hat Cloud Native Function (CNF) certification</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-helm"><a class="link" href="#cnf-best-practices-helm">2.1. Helm v3</a></h3>
<div class="paragraph">
<p>Helm v3 is a serverless mechanism for defining templates that describe a complete Kubernetes application. This allows you to build generic templates for applications that you can use with site or deployment specific values to be provided as inputs to the template.
Helm is roughly analogous to HEAT templates in the OpenStack environment.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://docs.openshift.com/container-platform/latest/applications/working_with_helm_charts/understanding-helm.html">Understanding Helm</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>If you use Helm to deploy your application, you must use Helm v3 because of security issues with Helm v2.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-k8s"><a class="link" href="#cnf-best-practices-k8s">2.2. Kubernetes</a></h3>
<div class="paragraph">
<p>Kubernetes is an open source container orchestration suite of software that is API driven with a datastore that manages the state of the deployments resident on the cluster.</p>
</div>
<div class="paragraph">
<p>The Kubernetes API is the mechanism that applications and users utilize to interact with the cluster. There are several ways to do this. For example, <code>kubectl</code> or <code>oc</code> CLI tools, web based UIs, or interacting directly with API using tools such as <code>curl</code>. You can use the SDK to build your own tools.</p>
</div>
<div class="paragraph">
<p>You can interact with the API in at least one of two ways. If the application or user is external to the cluster, the APIs can be accessed externally. If the application or user is directly connected to the cluster, they can access the cluster by using the Kubernetes Service Resource directly, bypassing the need to exit the cluster and log in again.</p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-cni-ovn"><a class="link" href="#cnf-best-practices-cni-ovn">2.3. CNI-OVN</a></h3>
<div class="paragraph">
<p>OVN is the default pod network CNI plugin for OpenShift and is supported by Red Hat. OVN is Red Hat&#8217;s CNI for pods. It is a Geneve based overlay that requires L3 reachability between the host nodes. This L3 reachability can be over L2 or a pre-existing overlay network. OpenShift&#8217;s OVN forwarding is based on flow rules and implemented with <code>nftables</code> on the host operating system CNI pod.</p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-csi"><a class="link" href="#cnf-best-practices-csi">2.4. Container storage (CSI)</a></h3>
<div class="paragraph">
<p>Pod volumes are supported via local storage and the CSI for persistent volumes. Local storage is truly ephemeral storage, it is local only to the physical node that a pod is running on and is lost when a pod is killed and recreated. If a pod requires persistent storage, the CSI can be used via Kubernetes native primitives <code>persistentVolume</code> (<code>PV</code>) and <code>persistentVolumeClaim</code> (<code>PVC</code>) to get persistent storage, such as an NFS share via the CSI backed by NetApp Trident.</p>
</div>
<div class="paragraph">
<p>When using storage with Kubernetes, you can use storage classes. Refer to <a href="#cnf-best-practices-block-storage">Block storage</a> for a description of the available storage classes. Using storage classes, you can create volumes based on the parameters of the required storage.</p>
</div>
<div class="paragraph">
<p>Network functions should clear persistent storage by deleting the associated <code>PV</code> resources when removing the application from a cluster.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://docs.openshift.com/container-platform/latest/storage/container_storage_interface/persistent-storage-csi.html">Red Hat Persistent Storage</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-block-storage"><a class="link" href="#cnf-best-practices-block-storage">2.5. Block storage</a></h3>
<div class="paragraph">
<p>OpenShift Container Platform can provision raw block volumes. These volumes do not have a file system, and can provide performance benefits for applications that either write to the disk directly or implement their own storage service.</p>
</div>
<div class="paragraph">
<p>There are 2 types of storage connectivity and 2 levels of storage in each. All block storage is located on a NetApp appliance.</p>
</div>
<div class="paragraph">
<p>The two types of storage connectivity are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">NFS</dt>
<dd>
<p>is the default storage type</p>
</dd>
<dt class="hdlist1">iSCSI</dt>
<dd>
<p>storage should only be used for database type applications</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See <a href="https://docs.openshift.com/container-platform/latest/storage/understanding-persistent-storage.html#block-volume-support_understanding-persistent-storage">Block Volume storage support</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-ephemeral-storage"><a class="link" href="#cnf-best-practices-ephemeral-storage">2.6. Ephemeral storage</a></h3>
<div class="paragraph">
<p>Pods and containers can require ephemeral or transient local storage for their operation. The lifetime of this ephemeral storage does not extend beyond the life of the individual pod, and this ephemeral storage cannot be shared across pods.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Pods must not place persistent data in ephemeral storage.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-local-storage"><a class="link" href="#cnf-best-practices-local-storage">2.7. Local storage</a></h3>
<div class="paragraph">
<p>Local storage is available on worker nodes for ephemeral storage only.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Pods must not place persistent volumes in local storage.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-container-runtime"><a class="link" href="#cnf-best-practices-container-runtime">2.8. Container runtime</a></h3>
<div class="paragraph">
<p>OpenShift uses CRI-O as a CRI interface for Kubernetes. CRI-O manages <code>runC</code> for container image execution. CRI-O is an open-source container engine that provides a stable, performant platform for running OCI compatible runtimes. CRI-O is developed, tested and released in tandem with Kubernetes major and minor releases.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Images should be OCI compliant. Red Hat recommends that you build images using Red Hat&#8217;s open Universal Base Image (UBI).</p>
</div>
<div class="paragraph">
<p>See <a href="#cnf-best-practices-ubi">Red Hat Universal Base Images</a> for additional information about UBI and support.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information about CRI-O, see the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://blog.openshift.com/add-a-layer-of-security-to-openshift-kubernetes-with-cri-o-in-read-only-mode/">Add a Layer of Security to OpenShift/Kubernetes with CRI-O in Read Only Mode</a></p>
</li>
<li>
<p><a href="https://github.com/cri-o/cri-o/blob/master/docs/crio.8.md">CRI-O docs</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This environment is maintained with the following open source tools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/opencontainers/runc">runc</a></p>
</li>
<li>
<p><a href="https://github.com/containers/skopeo">skopeo</a></p>
</li>
<li>
<p><a href="https://buildah.io/">buildah</a></p>
</li>
<li>
<p><a href="https://podman.io/">podman</a></p>
</li>
<li>
<p><a href="https://cri-o.io/">CRI-O</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-cpu-manager-pinning"><a class="link" href="#cnf-best-practices-cpu-manager-pinning">2.9. CPU manager/pinning</a></h3>
<div class="paragraph">
<p>The OpenShift platform can use the Kubernetes CPU Manager to support CPU pinning for applications.</p>
</div>
<div class="paragraph">
<p>Important note on using probes: If the CNF is doing CPU pinning and running a DPDK process do
not use exec probes (executing a command within the container) as it may pile up and block the
node eventually.</p>
</div>
<div class="paragraph">
<p>CNF Requirement: If a CNF is doing CPU pinning, exec probes may not be used.</p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-host-os"><a class="link" href="#cnf-best-practices-host-os">2.10. Container host operating system</a></h3>
<div class="paragraph">
<p>Red Hat Enterprise Linux CoreOS (RHCOS) is the next generation container operating system. RCHOS is part of OpenShift Container Platform and is used as the operating system for the control plane. it is the default operating system for worker nodes. RHCOS is based on RHEL, has some immutability, leverages the CRI-O runtime, contains container tools, and is updated through the Machine Config Operator (MCO).</p>
</div>
<div class="paragraph">
<p>The controlled immutability of RHCOS does not support installing RPMs or additional packages in the traditional way. Some 3rd party services or functionalities need to run as agents on nodes of the cluster.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://docs.openshift.com/container-platform/latest/architecture/architecture-rhcos.html">About RHCOS</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-ubi"><a class="link" href="#cnf-best-practices-ubi">2.11. Red Hat Universal Base Images</a></h3>
<div class="paragraph">
<p><a href="https://developers.redhat.com/products/rhel/ubi#assembly-field-sections-18455">Red Hat Universal Base Images (UBI)</a> is designed to be a foundation for containerized cloud-native and web application use cases. You can build a containerized application by using UBI, push it to your choice of registry server, and easily share it with others. UBI is freely redistributable, even to non-Red Hat platforms. No subscription is required. Since its built on Red Hat Enterprise Linux, UBI has the same industry leading reliability, security and performance benefits.</p>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-base-images"><a class="link" href="#cnf-best-practices-base-images">2.11.1. Base Images</a></h4>
<div class="paragraph">
<p>A set of three base images (Minimal, Standard, and Multi-service) are provided to provide optimum starting points for a variety of use cases.</p>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-runtime-languages"><a class="link" href="#cnf-best-practices-runtime-languages">2.11.1.1. Runtime Languages</a></h5>
<div class="paragraph">
<p>A set of language runtime images (PHP, Perl, Python, Ruby, Node.js) enable developers to start coding out of the gate with the confidence that a Red Hat built container image provides.</p>
</div>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-complementary-packages"><a class="link" href="#cnf-best-practices-complementary-packages">2.11.1.2. Complementary packages</a></h5>
<div class="paragraph">
<p>A set of associated YUM repositories/channels include RPM packages and updates that allow users to add application dependencies and rebuild UBI container images anytime they want.</p>
</div>
<div class="paragraph">
<p>Red Hat UBI images are the preferred images to build virtual network functions (VNFs) with as they leverage the fully supported Red Hat ecosystem. In addition, once a VNF is standardized on a Red Hat UBI, the image can become Red Hat certified.</p>
</div>
<div class="paragraph">
<p>Red Hat UBI images are free to vendors so there is a low barrier of entry to getting started. It is possible to utilize other base images to build containers that can be run on the OpenShift platform. See <a href="https://redhat-connect.gitbook.io/partner-guide-for-red-hat-openshift-and-container">Partner Guide for OpenShift and Container Certification</a> for a view of the ease of support for containers utilizing various base images and differing levels of certification and supportability.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-pod-security"><a class="link" href="#cnf-best-practices-pod-security">2.12. Pod security</a></h3>
<div class="paragraph">
<p>SELinux should always be enabled within the OpenShift Container Platform and will be used to enforce syscalls that containers make. In addition, Kubernetes has another native function called pod security policies.</p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-ci-cd"><a class="link" href="#cnf-best-practices-ci-cd">2.13. CI/CD framework</a></h3>
<div class="paragraph">
<p>Applications should target a CI/CD approach for deployment and validation.</p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-k8s-api-versions"><a class="link" href="#cnf-best-practices-k8s-api-versions">2.14. Kubernetes API versions</a></h3>
<div class="paragraph">
<p>Review the Kubernetes and OpenShift API documentation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/rest_api/index.html">OpenShift API index</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/reference/#">Kubernetes API reference</a></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>All CNFs must verify that they are compliant with the correct release of REST API for Kubernetes and OpenShift. Please refer to the online documentation for deprecated APIs.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-ovn-kubernetes-cni"><a class="link" href="#cnf-best-practices-ovn-kubernetes-cni">2.15. OVN-Kubernetes CNI</a></h3>
<div class="paragraph">
<p>OVN is Red Hat&#8217;s CNI for pod networking. It is a Geneve based overlay that requires L3 reachability between the host nodes. This L3 reachability can be over L2 or a pre-existing overlay network. Openshift&#8217;s OVN forwarding is based on flow rules and implemented with nftables on the host OS CNI pod.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://docs.openshift.com/container-platform/latest/networking/ovn_kubernetes_network_provider/about-ovn-kubernetes.html">About the OVN-Kubernetes network plugin</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-user-plane-functions"><a class="link" href="#cnf-best-practices-user-plane-functions">2.16. User plane functions</a></h3>
<div class="paragraph">
<p>Develop user plane functions that meet the following requirements.</p>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-performance-addon-operator-pao"><a class="link" href="#cnf-best-practices-performance-addon-operator-pao">2.16.1. Node Tuning Operator</a></h4>
<div class="paragraph">
<p>Red Hat created the
<a href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/cnf-low-latency-tuning.html#cnf-provisioning-real-time-and-low-latency-workloads_cnf-master">Node Tuning Operator</a> for low latency nodes.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>In OpenShift Container Platform version 4.10 and previous versions, the Performance Addon Operator was used to implement automatic tuning to achieve low latency performance. Now this functionality is part of the Node Tuning Operator.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The emergence of Edge computing in the area of Telco plays a key role in reducing latency, congestion, and improving application performance. Many of the deployed applications in the Telco space require low latency and zero packet loss. OpenShift Container Platform provides a Node Tuning Operator to implement automatic tuning to achieve low latency performance for applications. The Node Tuning Operator is a meta-operator that leverages <code>MachineConfig</code>, <code>Tuned</code> and <code>KubeletConfig</code> resources, Topology Manager, and CPU Manager, to optimize the nodes.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-huge-pages"><a class="link" href="#cnf-best-practices-huge-pages">2.17. Huge pages</a></h3>
<div class="paragraph">
<p>In OpenShift Container Platform, nodes/hosts must pre-allocate huge pages.</p>
</div>
<div class="paragraph">
<p>For more information, see
<a href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/cnf-low-latency-tuning.html#cnf-configuring-huge-pages_cnf-master">Configuring huge pages</a>.</p>
</div>
<div class="paragraph">
<p>To request hugepages, pods must supply the following within the <code>pod.spec</code> for each container:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">resources</span><span class="pi">:</span>
  <span class="na">limits</span><span class="pi">:</span>
    <span class="na">hugepages-2Mi</span><span class="pi">:</span> <span class="s">100Mi</span>
    <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1Gi"</span>
    <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1"</span>
  <span class="na">requests</span><span class="pi">:</span>
    <span class="na">hugepages-2Mi</span><span class="pi">:</span> <span class="s">100Mi</span>
    <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1Gi"</span>
    <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1"</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-cpu-isolation"><a class="link" href="#cnf-best-practices-cpu-isolation">2.18. CPU isolation</a></h3>
<div class="paragraph">
<p>The Node Tuning Operator manages host CPUs by dividing them into reserved CPUs for cluster and operating system housekeeping duties, and isolated CPUs for workloads. CPUs that are used for low latency workloads are set as isolated.</p>
</div>
<div class="paragraph">
<p>Device interrupts are load balanced between all isolated and reserved CPUs to avoid CPUs being overloaded, with the exception of CPUs where there is a guaranteed pod running. Guaranteed pod CPUs are prevented from processing device interrupts when the relevant annotations are set for the pod.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>To use isolated CPUs, specific annotations must be defined in the pod specification.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-topology-manager-and-numa-awareness"><a class="link" href="#cnf-best-practices-topology-manager-and-numa-awareness">2.19. Topology Manager and NUMA awareness</a></h3>
<div class="paragraph">
<p>Topology Manager collects hints from the CPU Manager, Device Manager, and other Hint Providers to align pod resources, such as CPU, SR-IOV VFs, and other device resources, for all Quality of Service (QoS) classes on the same non-uniform memory access (NUMA) node. This topology information and the configured Topology manager policy determine whether a workload is accepted or rejected on a node.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To align CPU resources with other requested resources in a Pod spec, the CPU Manager must be enabled with the static CPU Manager policy.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following Topology manager policies are available and dependent on the requirements of the workload can be enabled. For high performance workloads making use of SR-IOV VFs, NUMA awareness follows the NUMA node to which the SR-IOV capable network adapter is connected.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Best-effort policy</dt>
<dd>
<p>For each container in a pod with the best-effort topology management policy, kubelet calls each Hint Provider to discover their resource availability. Using this information, the Topology Manager stores the preferred NUMA Node affinity for that container. If the affinity is not preferred, Topology Manager stores this and admits the pod to the node.</p>
</dd>
<dt class="hdlist1">Restricted policy</dt>
<dd>
<p>For each container in a pod with the restricted topology management policy, kubelet calls each Hint Provider to discover their resource availability. Using this information, the Topology Manager stores the preferred NUMA Node affinity for that container. If the affinity is not preferred, Topology Manager rejects this pod from the node, resulting in a pod in a Terminated state with a pod admission failure.</p>
</dd>
<dt class="hdlist1">Single NUMA node policy</dt>
<dd>
<p>For each container in a pod with the single-numa-node topology management policy, kubelet calls each Hint Provider to discover their resource availability. Using this information, the Topology Manager determines if a single NUMA Node affinity is possible. If it is, the pod is admitted to the node. If a single NUMA Node affinity is not possible, the Topology Manager rejects the pod from the node. This results in a pod in a Terminated state with a pod admission failure. For more information about the Topology manager, see</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><a href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/using-cpu-manager.html">Using CPU Manager and Topology Manager</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-ipv4-&-ipv6"><a class="link" href="#cnf-best-practices-ipv4-&-ipv6">2.20. IPv4 &amp; IPv6</a></h3>
<div class="paragraph">
<p>Applications should discover services via DNS by doing an AAAA and A query. If an application gets a AAAA response the application should prefer using the IPv6 address in the AAAA response for application sockets.</p>
</div>
<div class="paragraph">
<p>In OpenShift Container Platform 4.7+, you can declare <code>ipFamilyPolicy: PreferDualStack</code> which will present an IPv4 and IPv6 address in the service.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF recommendation</div>
<div class="paragraph">
<p>IPv4 should only be used inside a pod when absolutely necessary.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF recommendation</div>
<div class="paragraph">
<p>Services should be created as IPv6 only services wherever possible. If an application requires dual stack it should create a dual stack service.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://kubernetes.io/docs/concepts/services-networking/dual-stack">IPv4/IPv6 dual-stack</a>.</p>
</div>
<div class="paragraph">
<p>To configure IPv4/IPv6 dual-stack, set dual-stack cluster network assignments:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">kube-apiserver</span><span class="pi">:</span>
  <span class="s">--service-cluster-ip-range=&lt;IPv4 CIDR&gt;,&lt;IPv6 CIDR&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-vrfs-aka-routing-instances"><a class="link" href="#cnf-best-practices-vrfs-aka-routing-instances">2.21. VRFs (aka routing instances)</a></h3>
<div class="paragraph">
<p>Virtual routing and forwarding (VRF) provides a way to have separate routing tables on the device enabling multiple L3 routing domains concurrently. This allows for traffic in different VRF to be treated independently of each other.</p>
</div>
<div class="paragraph">
<p>Generally a Load Balancer is used within the platform for L4 services and sometimes L7 load balancing services.
In a multi-tenant environment, Network Functions (NFs) can be deployed within a single namespace.
Supporting applications like an OAM platform for multiple NFs from the same vendor should be
run in an additional separate namespace.
The CNI interface should be used as the default mechanism for accessing VRFs. For
traffic inbound to an application this is done through allocation of a VIP on the load balancer via
the Kubernetes API on the appropriate VRF. For traffic outbound from an application selection of
the VRF is done on the application&#8217;s behalf via the Load Balancer and destination routing.
Multus will be supported within the platform for additional NICs within containers. However
Multus should be used only for those cases that cannot be supported by the load balancer.</p>
</div>
<div class="paragraph">
<p>The POD and Services networks are unrouted address space, they are only reachable via service
VIPs on the load balancers. The POD network will be NATed as traffic egresses the load balancer.
Traffic inbound will be destination NATed to Service/Pod IP addresses.</p>
</div>
<div class="paragraph">
<p>Applications should use Network Policies for firewalling the application. Network Policies should
be written with a default deny and only allow ports and protocols on an as needed basis for any
pods and services.</p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-ports-reserved-by-openshift"><a class="link" href="#cnf-best-practices-ports-reserved-by-openshift">2.22. Ports reserved by OpenShift</a></h3>
<div class="paragraph">
<p>The following ports are reserved by OpenShift and should not be used by any application. These ports are blocked by iptables on the nodes and traffic will not pass. Port list:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>22623</code></p>
</li>
<li>
<p><code>22624</code></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>The following ports are reserved by OpenShift and must not be used by any application: <code>22623</code>, <code>22624</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-user-plane-cnfs"><a class="link" href="#cnf-best-practices-user-plane-cnfs">2.23. Handling user-plane CNFs</a></h3>
<div class="paragraph">
<p>A CNF which handles user plane traffic or latency-sensitive payloads at line rate falls into this category, such as load balancing, routing, deep packet inspection, and so on. Some of these CNFs may also need to process the packets at a lower level.</p>
</div>
<div class="paragraph">
<p>This kind of CNF may need to:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use SR-IOV interfaces</p>
</li>
<li>
<p>Fully or partially bypassing the kernel networking stack with userspace networking technologies, like DPDK, F-stack, VPP, OpenFastPath, etc. A userspace networking stack can not only improve the performance but also reduce the need for the <code>CAP_NET_ADMIN</code> and <code>CAP_NET_RAW</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For Mellanox devices, those capabilities are requested if the application needs to configure the device(CAP_NET_ADMIN) and/or allocate raw ethernet queue through kernel drive(CAP_NET_RAW)</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As <code>CAP_IPC_LOCK</code> is mandatory for allocating hugepage memory, this capability is granted to DPDK-based applications. Additionally, if the workload is latency-sensitive and needs the determinacy provided by the real-time kernel, the <code>CAP_SYS_NICE</code> is also required.</p>
</div>
<div class="paragraph">
<p>Here is an example pod manifest of a DPDK application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">dpdk-app</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">&lt;target_namespace&gt;</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">k8s.v1.cni.cncf.io/networks</span><span class="pi">:</span> <span class="s">dpdk-network</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">testpmd</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">&lt;DPDK_image&gt;</span>
    <span class="na">securityContext</span><span class="pi">:</span>
      <span class="na">capabilities</span><span class="pi">:</span>
        <span class="na">add</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">IPC_LOCK"</span><span class="pi">]</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/dev/hugepages</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">hugepage</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">limits</span><span class="pi">:</span>
      <span class="na">openshift.io/mlxnics</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1"</span>
      <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1Gi"</span>
      <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">4"</span>
      <span class="na">hugepages-2Mi</span><span class="pi">:</span> <span class="s2">"</span><span class="s">4Gi"</span>
    <span class="na">requests</span><span class="pi">:</span>
      <span class="na">openshift.io/mlxnics</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1"</span>
      <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1Gi"</span>
      <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">4"</span>
      <span class="na">hugepages-2Mi</span><span class="pi">:</span> <span class="s2">"</span><span class="s">4Gi"</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">sleep"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">infinity"</span><span class="pi">]</span>
<span class="na">volumes</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">hugepage</span>
  <span class="na">emptyDir</span><span class="pi">:</span>
    <span class="na">medium</span><span class="pi">:</span> <span class="s">HugePages</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">security.openshift.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">SecurityContextConstraints</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">cnfname</span>
<span class="na">users</span><span class="pi">:</span> <span class="pi">[]</span>
<span class="na">groups</span><span class="pi">:</span> <span class="pi">[]</span>
<span class="na">priority</span><span class="pi">:</span> <span class="kc">null</span>
<span class="na">allowHostDirVolumePlugin</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostIPC</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostNetwork</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostPID</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostPorts</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="kc">true</span>
<span class="na">allowPrivilegedContainer</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowedCapabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">IPC_LOCK</span><span class="pi">,</span> <span class="nv">NET_ADMIN</span><span class="pi">,</span> <span class="nv">NET_RAW</span><span class="pi">]</span> <span class="na">defaultAddCapabilities</span><span class="pi">:</span> <span class="kc">null</span>
<span class="na">requiredDropCapabilities</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">KILL</span>
<span class="pi">-</span> <span class="s">MKNOD</span>
<span class="pi">-</span> <span class="s">SETUID</span>
<span class="pi">-</span> <span class="s">SETGID</span>
<span class="na">fsGroup</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">MustRunAs</span>
<span class="na">readOnlyRootFilesystem</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">runAsUser</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">MustRunAsRange</span>
<span class="na">seLinuxContext</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">MustRunAs</span>
<span class="na">supplementalGroups</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">RunAsAny</span>
<span class="na">volumes</span><span class="pi">:</span>
<span class="pi">-</span> <span class="s">configMap</span>
<span class="pi">-</span> <span class="s">downwardAPI</span>
<span class="pi">-</span> <span class="s">emptyDir</span>
<span class="pi">-</span> <span class="s">persistentVolumeClaim</span>
<span class="pi">-</span> <span class="s">projected</span>
<span class="pi">-</span> <span class="s">secret</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cnf-best-practices-developer-guide"><a class="link" href="#cnf-best-practices-developer-guide">3. CNF developer guide</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section discusses recommendations and requirements for CNF application builders.</p>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-preface"><a class="link" href="#cnf-best-practices-preface">3.1. Preface</a></h3>
<div class="paragraph">
<p>Cloud-native Network Functions (CNFs) are containerized instances of classic physical or virtual network functions (VNF) which have been decomposed into microservices supporting elasticity, lifecycle management, security, logging, and other capabilities in a Cloud-Native format.</p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-goal"><a class="link" href="#cnf-best-practices-goal">3.2. Goal</a></h3>
<div class="paragraph">
<p>This document is mainly for the developers of CNFs, who need to build high-performance Network Functions in a containerized environment. We have created a guide that any partner can take and follow when developing their CNFs so that they can be deployed on the OpenShift Container Platform (OCP) in a secure, efficient and supportable way.</p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-non-goal"><a class="link" href="#cnf-best-practices-non-goal">3.3. Non-goal</a></h3>
<div class="paragraph">
<p>This is not a guide on how to build CNFs functionality.</p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-refactoring"><a class="link" href="#cnf-best-practices-refactoring">3.4. Refactoring</a></h3>
<div class="paragraph">
<p>NFs should break their software down into the smallest set of microservices as possible. Running monolithic applications inside of a container is not the operating model to be in.</p>
</div>
<div class="paragraph">
<p>It is hard to move a 1000LB boulder. However, it is easy when that boulder is broken down into many pieces (pebbles). All containerized network functions (CNFs) should break apart each piece of the functions/services/processes into separate containers. These containers will still be within kubernetes pods and all of the functions that perform a single task should be within the same namespace.</p>
</div>
<div class="paragraph">
<p>There is a <a href="https://martinfowler.com/microservices/">quote</a> from Lewis and Fowler that describes this best:</p>
</div>
<div class="quoteblock">
<blockquote>
The microservice architectural style is an approach to developing a single application as a suite of small services, each running in its own process and communicating with lightweight mechanisms, often an HTTP resource API.These services are built around business capabilities and independently deployable by fully automated deployment machinery.
</blockquote>
<div class="attribution">
&#8212; Lewis and Fowler
</div>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-cnf-security"><a class="link" href="#cnf-best-practices-cnf-security">3.5. CNF security</a></h3>
<div class="paragraph">
<p>In OCP, it is possible to run privileged containers that have all of the root capabilities on a host machine, allowing the ability to access resources which are not accessible in ordinary containers. This, however, increases the security risk to the whole cluster. Containers should only request those privileges they need to run their legitimate functions. No containers will be allowed to run with full privileges without an exception.</p>
</div>
<div class="paragraph">
<p>The general guidelines are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Only ask for the necessary privileges and access control settings for your application.</p>
</li>
<li>
<p>If the function required by your CNF can be fulfilled by OCP components, your application should not be requesting escalated privilege to perform this function.</p>
</li>
<li>
<p>Avoid using any host system resource if possible.</p>
</li>
<li>
<p>Leveraging read only root filesystem when possible.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Only ask for the necessary privileges and access control settings for your application</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>If the function required by your CNF can be fulfilled by OCP components, your application should not be
requesting escalated privilege to perform this function.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Avoid using any host system resource.</p>
</div>
<div class="paragraph">
<p>See test cases <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-pod-host-ipc">access-control-pod-host-ipc</a>,
<a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-pod-host-pid">access-control-pod-host-pid</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Do not mount host directories for device access.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-pod-host-path">access-control-pod-host-path</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Do not use host network namespace.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-namespace">access-control-namespace</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>CNFs may not modify the platform in any way.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-avoid-accessing-resource-on-host"><a class="link" href="#cnf-best-practices-avoid-accessing-resource-on-host">3.5.1. Avoid accessing resource on host</a></h4>
<div class="paragraph">
<p>It is not recommended for an application to access following resources on the host.</p>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-avoid-mounting-host-directories-as-volumes"><a class="link" href="#cnf-best-practices-avoid-mounting-host-directories-as-volumes">3.5.2. Avoid mounting host directories as volumes</a></h4>
<div class="paragraph">
<p>It is not necessary to mount host <code>/sys/</code> or host <code>/dev/</code> directories as a volume in a pod in order to use a network device such as SR-IOV VF. The moving of a network interface into the pod network namespace is done automatically by CNI. Mounting the whole <code>/sys/</code> or <code>/dev/</code> directory in the container will overwrite the network device descriptor inside the container which causes <code>device not found</code> or <code>no such file or directory</code> error.</p>
</div>
<div class="paragraph">
<p>Network interface statistics can be queried inside the container using the same <code>/sys/</code> path as was done when running directly on the host. When running network interfaces in containers, relevant <code>/sys/</code> statistics interfaces are available inside the container, such as <code>/sys/class/net/net1/statistics/</code>, <code>/proc/net/tcp</code> and <code>/proc/net/tcp6</code>.</p>
</div>
<div class="paragraph">
<p>For running DPDK applications with SR-IOV VF, device specs (in case of vfio-pci) are automatically attached to the container via the Device Plugin. There is no need to mount the /dev/ directory as a volume in the container as the application can find device specs under <code>/dev/vfio/</code> in the container.</p>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-avoid-the-host-network-namespace"><a class="link" href="#cnf-best-practices-avoid-the-host-network-namespace">3.5.3. Avoid the host network namespace</a></h4>
<div class="paragraph">
<p>Application pods must avoid using <code>hostNetwork</code>. Applications may not use the host network, including <code>nodePort</code> for network communication. Any networking needs beyond the functions provided by the pod network and ingress/egress proxy must be serviced via a MULTUS connected interface.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Applications may not use <code>NodePorts</code> or the <code>hostNetwork</code>.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-service-type">access-control-service-type</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-linux-capabilities"><a class="link" href="#cnf-best-practices-linux-capabilities">3.6. Linux capabilities</a></h3>
<div class="paragraph">
<p>Linux Capabilities allow you to break apart the power of root into smaller groups of privileges. The <a href="https://man7.org/linux/man-pages/man7/capabilities.7.html">Linux capabilities(7)</a> man page provides a detailed description of how capabilities management is performed in Linux.
In brief, the Linux kernel associates various capability sets with threads and files. The threads Effective capability set determines the current privileges of a thread.</p>
</div>
<div class="paragraph">
<p>When a thread executes a binary program the kernel updates the various thread capability sets according to a set of rules that take into account the UID of thread before and after the exec system call and the file capabilities of the program being executed. Refer to the blog series in <a href="">10</a># for more details about []Linux capabilities and some examples. For Red Hat specific review of capabilities please refer to thelink:Linux Capabilities in OpenShift blog.# An additional reference is link:Docker Run Reference.[]</p>
</div>
<div class="paragraph">
<p>Users may choose to specify the required permissions for their running application in the Security Context of the pod specification. In OCP, administrators can use the Security Context Constraint (SCC) admission controller plugin to control the permissions allowed for pods deployed to the cluster. If the pod requests permissions that are not allowed by the SCCs available to that pod, the pod will not be admitted to the cluster.</p>
</div>
<div class="paragraph">
<p>The following runtime and SCC attributes control the capabilities that will be granted to a new container:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The capabilities granted to the CRI-O engine. The default capabilities are listed here: <a href="https://github.com/cri-o/cri-o/blob/master/internal/config/capabilities/capabilities.go" class="bare">https://github.com/cri-o/cri-o/blob/master/internal/config/capabilities/capabilities.go</a></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of Kubernetes version 1.18, CRI-O no longer runs with NET_RAW or SYS_CHROOT by default.
<a href="https://cri-o.github.io/cri-o/v1.18.0.html" class="bare">https://cri-o.github.io/cri-o/v1.18.0.html</a></p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The values in the SCC for <code>allowedCapabilities</code>, <code>defaultAddCapabilities</code> and <code>requiredDropCapabilities</code></p>
</li>
<li>
<p><code>allowPrivilegeEscalation</code>: controls whether a container can acquire extra privileges through setuid binaries or the file capabilities of binaries</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The capabilities associated with a new container are determined as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the container has the UID 0 (root) its Effective capability set is determined according to the capability attributes requested by the pod or container security context and allowed by the SCC assigned to the pod. In this case, the SCC provides a way to limit the capabilities of a root container.</p>
</li>
<li>
<p>If the container has a UID non 0 (non root), the new container has an empty Effective capability set (see <a href="https://github.com/kubernetes/kubernetes/issues/56374#" class="bare">https://github.com/kubernetes/kubernetes/issues/56374#</a>). In this case the SCC assigned to the pod controls only the capabilities the container may acquire through the file capabilities of binaries it will execute.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Considering the general recommendation to avoid running root containers, capabilities required by non-root containers are controlled by the pod or container security context and the SCC capability attributes but can only be acquired by properly setting the file capabilities of the container binaries.</p>
</div>
<div class="paragraph">
<p>Refer to <a href="https://docs.openshift.com/container-platform/4.7/authentication/managing-security-context-constraints.html" class="bare">https://docs.openshift.com/container-platform/4.7/authentication/managing-security-context-constraints.html</a> for more details on how to define and use the SCC.</p>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-default-capabilities"><a class="link" href="#cnf-best-practices-default-capabilities">3.6.1. DEFAULT capabilities</a></h4>
<div class="paragraph">
<p>The default capabilities that are allowed via the restricted SCC are as follows. <a href="https://github.com/cri-o/cri-o/blob/master/internal/config/capabilities/capabilities.go" class="bare">https://github.com/cri-o/cri-o/blob/master/internal/config/capabilities/capabilities.go</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"CHOWN"</code></p>
</li>
<li>
<p><code>"DAC_OVERRIDE"</code></p>
</li>
<li>
<p><code>"FSETID"</code></p>
</li>
<li>
<p><code>"FOWNER"</code></p>
</li>
<li>
<p><code>"SETPCAP"</code></p>
</li>
<li>
<p><code>"NET_BIND_SERVICE"</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The capabilities: "SETGID", "SETUID" &amp;"KILL", have been removed from the default OpenShift capabilities.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-ipc_lock"><a class="link" href="#cnf-best-practices-ipc_lock">3.6.2. IPC_LOCK</a></h4>
<div class="paragraph">
<p>IPC_LOCK capability is required if any of these functions are used in an application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mlock()</code></p>
</li>
<li>
<p><code>mlockall()</code></p>
</li>
<li>
<p><code>shmctl()</code></p>
</li>
<li>
<p><code>mmap()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Even though <code>mlock()</code> is not necessary on systems where page swap is disabled (for example on OpenShift), it may still be required as it is a function that is built into DPDK libraries, and DPDK based applications may indirectly call it by calling other functions.</p>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-net_admin"><a class="link" href="#cnf-best-practices-net_admin">3.6.3. NET_ADMIN</a></h4>
<div class="paragraph">
<p>NET_ADMIN capability is required to perform various network related administrative operations inside container such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MTU setting</p>
</li>
<li>
<p>Link state modification</p>
</li>
<li>
<p>MAC/IP address assignment</p>
</li>
<li>
<p>IP address flushing</p>
</li>
<li>
<p>Route insertion/deletion/replacement</p>
</li>
<li>
<p>Control network driver and hardware settings via <code>ethtool</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This doesn&#8217;t include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>add/delete a virtual interface inside a container. For example: adding a VLAN interface</p>
</li>
<li>
<p>Setting VF device properties</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All the administrative operations (except <code>ethtool</code>) mentioned above that require the <code>NET_ADMIN</code> capability should already be supported on the host by various CNIs in Openshift.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Only userplane applications or applications using SR-IOV or Multicast can request NET_ADMIN capability</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-net-admin-capability-check">access-control-net-admin-capability-check</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-avoid-sys_admin"><a class="link" href="#cnf-best-practices-avoid-sys_admin">3.6.4. Avoid SYS_ADMIN</a></h4>
<div class="paragraph">
<p>This capability is very powerful and overloaded. It allows the application to perform a range of system administration operations to the host. So you should avoid requiring this capability in your application.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Applications <strong>MUST NOT</strong> use the SYS_ADMIN Linux capability</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-sys_nice"><a class="link" href="#cnf-best-practices-sys_nice">3.6.5. SYS_NICE</a></h4>
<div class="paragraph">
<p>In the case that a CNF is running on a node using the real-time kernel, SYS_NICE will be used to allow DPDK application to switch to SCHED_FIFO.</p>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-sys_ptrace"><a class="link" href="#cnf-best-practices-sys_ptrace">3.6.6. SYS_PTRACE</a></h4>
<div class="paragraph">
<p>This capability is required when using Process Namespace Sharing. This is used when processes from one Container need to be exposed to another Container. For example, to send signals like SIGHUP from a process in a Container to another process in another Container. See <a href="https://kubernetes.io/docs/tasks/configure-pod-container/share-process-namespace/" class="bare">https://kubernetes.io/docs/tasks/configure-pod-container/share-process-namespace/</a> for more details.
For more information on these capabilities refer to <a href="https://cloud.redhat.com/blog/linux-capabilities-in-openshift" class="bare">https://cloud.redhat.com/blog/linux-capabilities-in-openshift</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-openshift-operations"><a class="link" href="#cnf-best-practices-openshift-operations">3.7. Operations that shall be executed by OpenShift</a></h3>
<div class="paragraph">
<p>The application should not require <code>NET_ADMIN</code> capability to perform the following administrative operations:</p>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-mtu-setting"><a class="link" href="#cnf-best-practices-mtu-setting">3.7.1. Setting the MTU</a></h4>
<div class="ulist">
<ul>
<li>
<p>Configure the MTU for the cluster network, also known as the OVN or Openshift-SDN network, by modifying the manifests generated by <code>openshift-installer</code> before deploying the cluster. See <a href="https://docs.openshift.com/container-platform/latest/networking/changing-cluster-network-mtu.html">Changing the MTU for the cluster network</a> for more information.</p>
</li>
<li>
<p>Configure additional networks managed by the Cluster Network Operator by using <code>NetworkAttachmentDefinition</code> resources generated by the Cluster Network Operator. See <a href="https://docs.openshift.com/container-platform/latest/networking/hardware_networks/using-sriov-multicast.html">Using high performance multicast</a> for more information.</p>
</li>
<li>
<p>Configure SR-IOV interfaces by using the SR-IOV Network Operator, see <a href="https://docs.openshift.com/container-platform/latest/networking/hardware_networks/configuring-sriov-device.html">Configuring an SR-IOV network device</a> for more information.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-link-state-modification"><a class="link" href="#cnf-best-practices-link-state-modification">3.7.2. Modifying link state</a></h4>
<div class="ulist">
<ul>
<li>
<p>All the links should be set up before attaching it to a pod.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-ip/mac-address-assignment"><a class="link" href="#cnf-best-practices-ip/mac-address-assignment">3.7.3. Assigning IP/MAC addresses</a></h4>
<div class="ulist">
<ul>
<li>
<p>For all the networks, the IP/MAC address should be assigned to the interface during pod creation.</p>
</li>
<li>
<p>MULTUS also allows users to override the IP/MAC address. Refer to <a href="https://docs.openshift.com/container-platform/latest/networking/multiple_networks/attaching-pod.html">Attaching a pod to an additional network</a> for more information.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-manipulate-pods-route-table"><a class="link" href="#cnf-best-practices-manipulate-pods-route-table">3.7.4. Manipulating pod route tables</a></h4>
<div class="ulist">
<ul>
<li>
<p>By default, the default route of the pod will point to the cluster network, with or without the additional networks. MULTUS also allows users to override the default route of the pod. Refer to <a href="https://docs.openshift.com/container-platform/latest/networking/multiple_networks/attaching-pod.html">Attaching a pod to an additional network</a> for more information.</p>
</li>
<li>
<p>Non-default routes can be added to pod routing tables by various IPAM CNI plugins during pod creation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-sr/iov-vf-setting"><a class="link" href="#cnf-best-practices-sr/iov-vf-setting">3.7.5. Setting SR/IOV VFs</a></h4>
<div class="paragraph">
<p>The SR-IOV Network Operator also supports configuring the following parameters for SR-IOV VFs. Refer to <a href="https://docs.openshift.com/container-platform/latest/networking/hardware_networks/configuring-sriov-net-attach.html">Configuring an SR-IOV Ethernet network attachment</a> for more information.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>vlan</code></p>
</li>
<li>
<p><code>linkState</code></p>
</li>
<li>
<p><code>maxTxRate</code></p>
</li>
<li>
<p><code>minRxRate</code></p>
</li>
<li>
<p><code>vlanQoS</code></p>
</li>
<li>
<p><code>spoofChk</code></p>
</li>
<li>
<p><code>trust</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-multicast"><a class="link" href="#cnf-best-practices-multicast">3.7.6. Configuring multicast</a></h4>
<div class="paragraph">
<p>In OpenShift, multicast is supported for both the default interface (OVN or OpenShift-SDN) and the additional interfaces such as macvlan, SR-IOV, etc. Multicast is disabled by default. To enable it, refer to the following procedures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/networking/openshift_sdn/enabling-multicast.html">Enabling multicast for a project</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/networking/hardware_networks/using-sriov-multicast.html#nw-using-an-sriov-interface-for-multicast_using-sriov-multicast">Configuring an SR-IOV interface for multicast</a></p>
</li>
<li>
<p>If your application works as a multicast source and you want to utilize the additional interfaces to carry the multicast traffic, then you dont need the <code>NET_ADMIN</code> capability. Follow the instructions in <a href="https://docs.openshift.com/container-platform/latest/networking/hardware_networks/using-sriov-multicast.html">Using high performance multicast</a> to set the correct multicast route in the pods routing table.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-operations-that-can-not-be-executed-by-openshift"><a class="link" href="#cnf-best-practices-operations-that-can-not-be-executed-by-openshift">3.7.7. Operations that can not be executed by OpenShift</a></h4>
<div class="paragraph">
<p>All the CNI plugins are only invoked during pod creation and deletion. If your CNF needs perform any operations mentioned above at runtime, the <code>NET_ADMIN</code> capability is required.</p>
</div>
<div class="paragraph">
<p>There are some other functionalities that are not currently supported by any of the OpenShift components which also require <code>NET_ADMIN</code> capability:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Link state modification at runtime</p>
</li>
<li>
<p>IP/MAC modification at runtime</p>
</li>
<li>
<p>Manipulate pods route table or firewall rules at runtime</p>
</li>
<li>
<p>SR/IOV VF setting at runtime</p>
</li>
<li>
<p>Netlink configuration</p>
</li>
<li>
<p>For example, <code>ethtool</code> can be used to configure things like rxvlan, txvlan, gso, tso, etc.</p>
</li>
<li>
<p>Multicast</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your application works as a receiving member of IGMP groups, you need to specify the NET_ADMIN capability in the pod manifest. So that the app is allowed to assign multicast addresses to the pod interface and join an IGMP group.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Set <code>SO_PRIORITY</code> to a socket to manipulate the 802.1p priority in ethernet frames</p>
</li>
<li>
<p>Set <code>IP_TOS</code> to a socket to manipulate the DSCP value of IP packets</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-analyzing-your-application"><a class="link" href="#cnf-best-practices-analyzing-your-application">3.7.8. Analyzing your application</a></h4>
<div class="paragraph">
<p>To find out which capabilities the application needs, Red Hat has developed a SystemTap script (<code>container_check.stp</code>). With this tool, the CNF developer can find out what capabilities an application requires in order to run in a container. It also shows the syscalls which were invoked. Find more info at <a href="https://linuxera.org/capabilities-seccomp-kubernetes/" class="bare">https://linuxera.org/capabilities-seccomp-kubernetes/</a></p>
</div>
<div class="paragraph">
<p>Another tool is <code>capable</code> which is part of the BCC tools. It can be installed on RHEL8 with <code>dnf install bcc</code>.</p>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-example"><a class="link" href="#cnf-best-practices-example">3.7.8.1. Finding the capabilities that an application needs</a></h5>
<div class="paragraph">
<p>Here is an example of how to find out the capabilities that an application needs. <code>testpmd</code> is a DPDK based layer-2 forwarding application. It needs the <code>CAP_IPC_LOCK</code> to allocate the hugepage memory.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use container_check.stp. We can see <code>CAP_IPC_LOCK</code> and <code>CAP_SYS_RAWIO</code> are requested by <code>testpmd</code> and the relevant syscalls.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span><span class="nv">$ </span>/usr/share/systemtap/examples/profiling/container_check.stp <span class="nt">-c</span> <span class="s1">'testpmd -l 1-2 -w 0000:00:09.0 -- -a --portmask=0x8 --nb-cores=1'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="go">[...]
capabilities used by executables
    executable:   prob capability
    testpmd:      cap_ipc_lock
    testpmd:      cap_sys_rawio

capabilities used by syscalls
    executable,   syscall ( capability )    : count
    testpmd,      mlockall ( cap_ipc_lock ) : 1
    testpmd,      mmap ( cap_ipc_lock )     : 710
    testpmd,      open ( cap_sys_rawio )    : 1
    testpmd,      iopl ( cap_sys_rawio )    : 1

failed syscalls
    executable,          syscall =       errno:   count
    eal-intr-thread,  epoll_wait =       EINTR:       1
    lcore-slave-2,          read =            :       1
    rte_mp_handle,       recvmsg =            :       1
    stapio,                      =       EINTR:       1
    stapio,               execve =      ENOENT:       3
    stapio,        rt_sigsuspend =            :       1
    testpmd,               flock =      EAGAIN:       5
    testpmd,                stat =      ENOENT:      10
    testpmd,               mkdir =      EEXIST:       2
    testpmd,            readlink =      ENOENT:       3
    testpmd,              access =      ENOENT:    1141
    testpmd,              openat =      ENOENT:       1
    testpmd,                open =      ENOENT:      13
    [...]</span></code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>capable</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>/usr/share/bcc/tools/capable</code></pre>
</div>
</div>
</li>
<li>
<p>Start the testpmd application from another terminal, and send some test traffic to it. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>testpmd <span class="nt">-l</span> 18-19 <span class="nt">-w</span> 0000:01:00.0 <span class="nt">--</span> <span class="nt">-a</span> <span class="nt">--portmask</span><span class="o">=</span>0x1 <span class="nt">--nb-cores</span><span class="o">=</span>1</code></pre>
</div>
</div>
</li>
<li>
<p>Check the output of the <code>capable</code> command. Below, <code>CAP_IPC_LOCK</code> was requested for running <code>testpmd</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="go">[...]
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
[...]</span></code></pre>
</div>
</div>
</li>
<li>
<p>Also, try to run <code>testpmd</code> without <code>CAP_IPC_LOCK</code> set with <code>capsh</code>. Now we can see that the hugepage memory cannot be allocated.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>capsh <span class="nt">--drop</span><span class="o">=</span>cap_ipc_lock <span class="nt">--</span> <span class="nt">-c</span> testpmd <span class="nt">-l</span> 18-19 <span class="nt">-w</span> 0000:01:00.0 <span class="nt">--</span> <span class="nt">-a</span> <span class="nt">--portmask</span><span class="o">=</span>0x1 <span class="nt">--nb-cores</span><span class="o">=</span>1</code></pre>
</div>
</div>
<div class="paragraph">
<p>+
.Example output</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="go">EAL: Detected 24 lcore(s)
EAL: Detected 2 NUMA nodes
EAL: Multi-process socket /var/run/dpdk/rte/mp_socket
EAL: No free hugepages reported in hugepages-1048576kB
EAL: Probing VFIO support...
EAL: VFIO support initialized
EAL: PCI device 0000:01:00.0 on NUMA socket 0
EAL: probe driver: 8086:10fb net_ixgbe
EAL: using IOMMU type 1 (Type 1)
EAL: Ignore mapping IO port bar(2)
EAL: PCI device 0000:01:00.1 on NUMA socket 0
EAL: probe driver: 8086:10fb net_ixgbe
EAL: PCI device 0000:07:00.0 on NUMA socket 0
EAL: probe driver: 8086:1521 net_e1000_igb
EAL: PCI device 0000:07:00.1 on NUMA socket 0
EAL: probe driver: 8086:1521 net_e1000_igb
</span><span class="gp">EAL: cannot set up DMA remapping, error 12 (Cannot allocate memory) testpmd: mlockall() failed with error "Cannot allocate memory" testpmd: create a new mbuf pool &lt;mbuf_pool_socket_0&gt;</span>: <span class="nv">n</span><span class="o">=</span>331456, <span class="nv">size</span><span class="o">=</span>2176, <span class="nv">socket</span><span class="o">=</span>0
<span class="go">testpmd: preferred mempool ops selected: ring_mp_mc
</span><span class="gp">EAL: cannot set up DMA remapping, error 12 (Cannot allocate memory) testpmd: create a new mbuf pool &lt;mbuf_pool_socket_1&gt;</span>: <span class="nv">n</span><span class="o">=</span>331456, <span class="nv">size</span><span class="o">=</span>2176,
<span class="go">socket=1
testpmd: preferred mempool ops selected: ring_mp_mc
EAL: cannot set up DMA remapping, error 12 (Cannot allocate memory) EAL: cannot set up DMA remapping, error 12 (Cannot allocate memory)</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-cnf-network-security"><a class="link" href="#cnf-best-practices-cnf-network-security">3.7.9. Securing CNF networks</a></h4>
<div class="paragraph">
<p>CNFs must have the least permissions possible and CNFs must implement Network Policies that drop all traffic by default and permit only the relevant ports and protocols to the narrowest ranges of addresses possible.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Applications must define network policies that permit only the minimum network access the application needs to function.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-secrets-management"><a class="link" href="#cnf-best-practices-secrets-management">3.7.10. Managing secrets</a></h4>
<div class="paragraph">
<p>Secrets objects in OpenShift provide a way to hold sensitive information such as passwords, config files and credentials. There are 4 types of secrets; service account, basic auth, ssh auth and TLS. Secrets can be added via deployment configurations or consumed by pods directly. For more information on secrets and examples, see the following documentation.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.openshift.com/container-platform/latest/nodes/pods/nodes-pods-secrets.html">Providing sensitive data to pods</a></p>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-scc-permissions-for-an-application"><a class="link" href="#cnf-best-practices-scc-permissions-for-an-application">3.7.11. Setting SCC permissions for applications</a></h4>
<div class="paragraph">
<p>Permissions to use an SCC is done by adding a cluster role that has <em>uses</em> permissions for the SCC and then rolebindings for the users within a namespace to that role for users that need that SCC. Application admins can create their own role/rolebindings to assign permissions to a Service Account.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-expectations-permissions"><a class="link" href="#cnf-best-practices-expectations-permissions">3.8. Cloud-native function expectations and permissions</a></h3>
<div class="paragraph">
<p>Cloud-native applications are developed as loosely-coupled well-behaved manageable microservices running in containers managed by a container orchestration engine such as kubernetes.</p>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-cloud-native-design-best-practices"><a class="link" href="#cnf-best-practices-cloud-native-design-best-practices">3.8.1. Cloud-native design best practices</a></h4>
<div class="paragraph">
<p>The following best practices highlight some key principles of cloud-native application design.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Single purpose w/messaging interface</dt>
<dd>
<p>A container should address a single purpose with a well-defined (typically RESTful API) messaging interface. The motivation here is that such a container image is more reusable and more replaceable/upgradeable.</p>
</dd>
<dt class="hdlist1">High observability</dt>
<dd>
<p>A container must provide APIs for the platform to observe the container health and act accordingly. These APIs include health checks (liveness and readiness), logging to stderr and stdout for log aggregation (by tools such as <code>Logstash</code> or <code>Filebeat</code>), and integrate with tracing and metrics-gathering libraries (such as <code>Prometheus</code> or <code>Metricbeat</code>).</p>
</dd>
<dt class="hdlist1">Lifecycle conformance</dt>
<dd>
<p>A container must receive important events from the platform and conform/react to these events properly. For example, a container should catch SIGTERM or SIGKILL from the platform and shut down as quickly as possible. Other typically important events from the platform are PostStart to initialize before servicing requests and PreStop to release resources cleanly before shutting down.</p>
</dd>
<dt class="hdlist1">Image immutability</dt>
<dd>
<p>Container images are meant to be immutable; i.e. customized images for different environments should typically not be built. Instead, an external means for storing and retrieving configurations that vary across environments for the container should be used. Additionally, the container image should NOT dynamically install additional packages at runtime.</p>
</dd>
<dt class="hdlist1">Process disposability</dt>
<dd>
<p>Containers should be as ephemeral as possible and ready to be replaced by another container instance at any point in time. There are many reasons to replace a container, such as failing a health check, scaling down the application, migrating the containers to a different host, platform resource starvation, or another issue.</p>
<div class="paragraph">
<p>This means that containerized applications must keep their state externalized or distributed and redundant. To store files or block level data, persistent volume claims should be used. For information such as user sessions, use of an external, low-latency, key-value store such as redis should be used. Process disposability also requires that the application should be quick in starting up and shutting down, and even be ready for a sudden, complete hardware failure.</p>
</div>
<div class="paragraph">
<p>Another helpful practice in implementing this principle is to create small containers. Containers in cloud-native environments may be automatically scheduled and started on different hosts. Having smaller containers leads to quicker start-up times because before being restarted, containers need to be physically copied to the host system.</p>
</div>
<div class="paragraph">
<p>A corollary of this practice is to "retry instead of crashing", for example, When one service in your application depends on another service, it should not crash when the other service is unreachable. For example, your API service is starting up and detects the database is unreachable. Instead of failing and refusing to start, you design it to retry the connection. While the database connection is down the API can respond with a 503 status code, telling the clients that the service is currently unavailable. This practice should already be followed by applications, but if you are working in a containerized environment where instances are disposable, then the need for it becomes more obvious.</p>
</div>
<div class="paragraph">
<p>Also related to this, by default containers are launched with shared images using COW filesystems which only exist as long as the container exists. Mounting Persistent Volume Claims enables a container to have persistent physical storage. Clearly defining the abstraction for what storage is persisted promotes the idea that instances are disposable.</p>
</div>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Application design should conform to cloud-native design principles to the maximum extent possible.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-high-level-cnf-expectations"><a class="link" href="#cnf-best-practices-high-level-cnf-expectations">3.8.1.1. High-level CNF expectations</a></h5>
<div class="ulist">
<ul>
<li>
<p>CNFs shall be built to be cloud-native</p>
</li>
<li>
<p>Containers MUST NOT run as root (uid=0). See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-security-context-non-root-user-check">access-control-security-context-non-root-user-check</a></p>
</li>
<li>
<p>Containers MUST run with the minimal set of permissions required. Avoid Privileged Pods. See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-security-context-privilege-escalation">access-control-security-context-privilege-escalation</a></p>
</li>
<li>
<p>Use the main CNI for all traffic - MULTUS/SRIOV/MacVLAN are for corner cases only (extreme throughput requirements, protocols that are unable to be load balanced)</p>
</li>
<li>
<p>CNFs should employ N+k redundancy models</p>
</li>
<li>
<p>CNFs MUST define their pod affinity/anti-affinity rules.</p>
</li>
<li>
<p>All secondary network interfaces employed by CNFs with the use of MULTUS MUST support Dual-Stack IPv4/IPv6.</p>
</li>
<li>
<p>Instantiation of CNF (via Helm chart or Operators or otherwise) shall result in a fully-functional CNF ready to serve traffic, without requiring any post-instantiation configuration of system parameters</p>
</li>
<li>
<p>CNFs shall implement service resilience at the application layer and not rely on individual compute availability/stability</p>
</li>
<li>
<p>CNFs shall decouple application configuration from Pods, to allow dynamic configuration updates</p>
</li>
<li>
<p>CNFs shall support elasticity with dynamic scale up/down using kubernetes-native constructs such as ReplicaSets, etc.</p>
</li>
<li>
<p>CNFs shall support canary upgrades</p>
</li>
<li>
<p>CNFs shall self-recover from common failures like pod failure, host failure, and network failure. Kubernetes native mechanisms such as health-checks (Liveness, Readiness and Startup Probes) shall be employed at a minimum.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Containers must not run as root</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-security-context-non-root-user-check">access-control-security-context-non-root-user-check</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>All secondary interfaces (MULTUS) must support dual stack</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>CNFs shall not use node selectors nor taints/tolerations to assign pod location</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-pod-permissions"><a class="link" href="#cnf-best-practices-pod-permissions">3.8.1.2. Pod permissions</a></h5>
<div class="paragraph">
<p>By default, pods should not expect to be permitted to run as root. Pod restrictions are enforced by SCC within the OpenShift platform. See <a href="https://docs.openshift.com/container-platform/latest/authentication/managing-security-context-constraints.html">Managing security context constraints</a>.</p>
</div>
<div class="paragraph">
<p>Pods will execute on worker nodes, by default being admitted to the cluster with the "restricted" SCC.</p>
</div>
<div class="paragraph">
<p>The "restricted" SCC:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ensures that no containers within the pod can run with the <code>allowPrivilegedContainer</code> flag set.</p>
</li>
<li>
<p>Ensures that pods cannot mount host directory volumes.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-pod-host-path">access-control-pod-host-path</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Requires that a pod run as a user in a pre-allocated range of UIDs from the namespace annotation.</p>
</li>
<li>
<p>Requires that a pod run with a pre-allocated MCS label from the namespace annotation.</p>
</li>
<li>
<p>Allows pods to use any supplemental group.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Any pods requiring elevated privileges must document the required capabilities driven by application syscalls and a process to validate the requirements must occur.</p>
</div>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-logging"><a class="link" href="#cnf-best-practices-logging">3.8.1.3. Logging</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1">Log aggregation and analysis</dt>
</dl>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Containers are expected to write logs to stdout. It is highly recommended that stdout/stderr leverage some standard logging format for output.</p>
</li>
<li>
<p>Logs CAN be parsed to a limited extent so that specific vendor logs can be sent back to the CNF if required.</p>
</li>
<li>
<p>CNFs requiring log parsing must leverage some standard logging library or format for all stdout/stderr. Examples of standard logging libraries include; <code>klog</code>, <code>rfc5424</code>, and <code>oslo</code>.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-monitoring"><a class="link" href="#cnf-best-practices-monitoring">3.8.1.4. Monitoring</a></h5>
<div class="paragraph">
<p>Network Functions are expected to bring their own metrics collection functions (e.g. Prometheus) for their application specific metrics. This metrics collector will not be expected to nor able to poll platform level metric data.</p>
</div>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-cpu-allocation"><a class="link" href="#cnf-best-practices-cpu-allocation">3.8.1.5. CPU allocation</a></h5>
<div class="paragraph">
<p>It is important to note that when the OpenShift scheduler is placing pods, it first reviews the Pod CPU request and schedules it if there is a node that meets the requirements. It will then impose the CPU "Limits" to ensure the Pod doesn&#8217;t consume more than the intended allocation. The limit can never be lower than the request.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">NUMA Configuration</dt>
<dd>
<p>OpenShift provides a topology manager which leverages the CPU manager and Device manager to help associate processes to CPUs. Topology manager handles NUMA affinity. This feature is available as of OpenShift 4.6. For some examples on how to leverage the topology manager and creating workloads that work in real time, see <a href="https://docs.openshift.com/container-platform/4.12/scalability_and_performance/cnf-numa-aware-scheduling.html">Scheduling NUMA-aware workloads</a> and <a href="https://docs.openshift.com/container-platform/4.12/scalability_and_performance/cnf-low-latency-tuning.html">Low latency tuning</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-memory-allocation"><a class="link" href="#cnf-best-practices-memory-allocation">3.8.1.6. Memory allocation</a></h5>
<div class="paragraph">
<p>Regarding memory allocation, there are a couple of considerations. How much of the platform is OpenShift itself using, and how much is left over to allocate for the applications running on OpenShift?</p>
</div>
<div class="paragraph">
<p>Once it has been determined how much memory is left over for the applications, quotas can be applied which specify both the requested amount of memory and limits. In the case of where a memory request has been specified, OpenShift will not schedule the pod unless the amount of memory required to launch it is available. In the case of a limit being specified, OpenShift will not allocate more memory to the application than the limit provides.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>When the OpenShift scheduler is placing pods, it reviews the pod memory request and schedules the pod if there is a node that meets the requirements. It then imposes memory limits to ensure the pod doesn&#8217;t consume more than the intended allocation. The limit can never be lower than the request.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Vendors must supply quotas per project/namespace</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-namespace-resource-quota">access-control-namespace-resource-quota</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-pods"><a class="link" href="#cnf-best-practices-pods">3.8.1.7. Pods</a></h5>
<div class="paragraph">
<p>Pods are the smallest deployable units of computing that can be created and managed in Kubernetes.</p>
</div>
<div class="paragraph">
<p>A Pod can contain one or more running containers at a time. Containers running in the same Pod have access to several of the same Linux namespaces. For example, each application has access to the same network namespace, meaning that one running container can communicate with another running container over <code>127.0.0.1:&lt;port&gt;</code>. The same is true for storage volumes so all containers are in the same Pod have access to the same mount namespace and can mount the same volumes.</p>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-pod-interaction/configuration"><a class="link" href="#cnf-best-practices-pod-interaction/configuration">3.8.1.7.1. Pod interaction and configuration</a></h6>
<div class="paragraph">
<p>Pod configurations should be created in a kubernetes native manner, the most basic example of a kubernetes native manner of configuration deployment is the use of a <code>ConfigMap</code> CR. <code>ConfigMap</code> CRs can be loaded into Kubernetes and pods can consume the data in a configmap by using the data in the <code>ConfigMap</code> to populate container environment variables or can be consumed as volumes in a container and read by an application.</p>
</div>
<div class="paragraph">
<p>Interaction with a running pod should be done via <code>oc exec</code> or <code>oc rsh</code> commands. This allows API role-based access control (RBAC) to the pods and command line interaction for debugging.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>SSH daemons must NOT be used in Openshift for pod interaction.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-pod-exit-status"><a class="link" href="#cnf-best-practices-pod-exit-status">3.8.1.7.2. Pod exit status</a></h6>
<div class="paragraph">
<p>The most basic requirement for the lifecycle management of pods in OpenShift is the ability to start and stop correctly. When starting up, health probes like liveness and readiness checks can be put into place to ensure the application is functioning properly.</p>
</div>
<div class="paragraph">
<p>There are different ways a pod can be stopped in Kubernetes. One way is that the pod can remain alive but non-functional. Another way is that the pod can crash and become non-functional. In the first case, if the administrator has implemented liveness and readiness checks, OpenShift can stop the pod and either restart it on the same node or a different node in the cluster. For the second case, when the application in the pod stops, it should exit with a code and write suitable log entries to help the administrator diagnose what the issue was that caused the problem.</p>
</div>
<div class="paragraph">
<p>Pods should use <code>terminationMessagePolicy: FallbackToLogsOnError</code> to summarize why they crashed and use stderr to report errors on crash</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>All pods shall have a liveness, readiness and startup probes defined</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-graceful-termination"><a class="link" href="#cnf-best-practices-graceful-termination">3.8.1.7.3. Graceful termination</a></h6>
<div class="paragraph">
<p>There are different reasons that a pod may need to shutdown on an OpenShift cluster. It might be that the node the pod is running on needs to be shut down for maintenance, or the administrator is doing a rolling update of an application to a new version which requires that the old versions are shutdown properly.</p>
</div>
<div class="paragraph">
<p>When pods are shut down by the platform they are sent a <code>SIGTERM</code> signal which means that the process in the container should start shutting down, closing connections and stopping all activity. If the pod doesn&#8217;t shut down within the default 30 seconds then the platform may send a <code>SIGKILL</code> signal which will stop the pod immediately. This method isn&#8217;t as clean and the default time between the <code>SIGTERM</code> and <code>SIGKILL</code> messages can be modified based on the requirements of the application.</p>
</div>
<div class="paragraph">
<p>Pods should exit with zero exit codes when they are gracefully terminated.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>All pods must respond to SIGTERM signal and shutdown gracefully with a zero exit code.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-pod-resource-profiles"><a class="link" href="#cnf-best-practices-pod-resource-profiles">3.8.1.7.4. Pod resource profiles</a></h6>
<div class="paragraph">
<p>OpenShift has a default scheduler that is responsible for the currently available resources on the platform, placing containers or applications on the platform appropriately. In order for OpenShift to do this correctly, the application developer must create a resource profile for the application. This resource profile contains requirements such as how much memory, CPU, and storage that the application needs. At this point, the scheduler is aware of what nodes in the cluster can satisfy the workload. It places the application on one of those nodes. The scheduler can also place the application pod in a pending state until resources are available.</p>
</div>
<div class="paragraph">
<p>All pods should have a resource request that is the minimum amount o fresources the pod is expected to use at steady state for both memory and CPU.</p>
</div>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-storage:-emptydir"><a class="link" href="#cnf-best-practices-storage:-emptydir">3.8.1.7.5. Storage: emptyDir</a></h6>
<div class="paragraph">
<p>There are several options for volumes and reading and writing files in OpenShift. When the requirement is temporary storage and given the option to write files into directories in containers versus an external filesystems, choose the <code>emptyDir</code> option. This will provide the administrator with the same temporary filesystem - when the pod is stopped the dir is deleted forever. Also, the <code>emptyDir</code> can be backed by whatever medium is backing the node, or it can be set to memory for faster reads and writes.</p>
</div>
<div class="paragraph">
<p>Using <code>emptyDir</code> with requested local storage limits instead of writing to the container directories also allows enabling <code>readonlyRootFilesystem</code> on the container or pod.</p>
</div>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-liveness-readiness-and-startup-probes"><a class="link" href="#cnf-best-practices-liveness-readiness-and-startup-probes">3.8.1.7.6. Liveness readiness and startup probes</a></h6>
<div class="paragraph">
<p>As part of the pod lifecycle, the OpenShift platform needs to know what state the pod is in at all times. This can be accomplished with different health checks. There are at least three states that are important to the platform: startup, running, shutdown. Applications can also be running, but not healthy, meaning, the pod is up and the application shows no errors, but it cannot serve any requests.</p>
</div>
<div class="paragraph">
<p>When an application starts up on OpenShift it may take a while for the application to become ready to accept connections from clients, or perform whatever duty it is intended for.</p>
</div>
<div class="paragraph">
<p>Two health checks that are required to monitor the status of the applications are liveness and readiness. As mentioned above, the application can be running but not actually able to serve requests. This can be detected with liveness checks. The liveness check will send specific requests to the application that, if satisfied, indicate that the pod is in a healthy state and operating within the required parameters that the administrator has set. A failed liveness check will result in the container being restarted.</p>
</div>
<div class="paragraph">
<p>There is also a consideration of pod startup. Here the pod may start and take a while for different reasons. Pods can be marked as ready if they pass the readiness check. The readiness check determines that the pod has started properly and is able to answer requests. There are circumstances where both checks are used to monitor the applications in the pods. A failed readiness check results in the container being taken out of the available service endpoints. An example of this being relevant is when the pod was under heavy load, failed the readiness check, gets taken out of the endpoint pool, processes requests, passes the readiness check and is added back to the endpoint pool.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/">Configure Liveness, Readiness and Startup Probes</a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the CNF is doing CPU pinning and running a DPDK process do not use exec probes (executing a command within the container); as this can pile up and eventually block the node.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Do not use exec probes if a CNF is doing CPU pinning.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-affinity/anti-affinity"><a class="link" href="#cnf-best-practices-affinity/anti-affinity">3.8.1.7.7. Affinity and anti-affinity</a></h6>
<div class="paragraph">
<p>In OpenShift Container Platform pod affinity and pod anti-affinity allow you to constrain which nodes your pod are eligible to be scheduled based on the key/value labels on other pods. There are two types of affinity rules, required and preferred. Required rules must be met, whereas preferred rules are best effort.</p>
</div>
<div class="paragraph">
<p>These pod affinity/anti-affinity rules are set in the pod specification as <code>matchExpressions</code> to a <code>labelSelector</code>. See <a href="https://docs.openshift.com/container-platform/latest/nodes/scheduling/nodes-scheduler-pod-affinity.html">Placing pods relative to other pods using affinity and anti-affinity rules</a>more information. The following example <code>Pod</code> CR illustrates pod affinity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">with-pod-affinity</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">affinity</span><span class="pi">:</span>
    <span class="na">podAffinity</span><span class="pi">:</span>
      <span class="na">requiredDuringSchedulingIgnoredDuringExecution</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">labelSelector</span><span class="pi">:</span>
            <span class="na">matchExpressions</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">key</span><span class="pi">:</span> <span class="s">security</span>
              <span class="na">operator</span><span class="pi">:</span> <span class="s">In</span>
              <span class="na">values</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">S1</span>
        <span class="na">topologyKey</span><span class="pi">:</span> <span class="s">failure-domain.beta.kubernetes.io/zone</span>
  <span class="na">containers</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">with-pod-affinity</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">docker.io/ocpqe/hello-pod</span></code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Pods that need to be co-located on the same node need affinity rules. Pods that should not be
co-located for resiliency purposes require anti-affinity rules.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Pods that perform the same microservice and could be disrupted if multiple members of the service are
unavailable must implement affinity/anti-affinity group rules or spread the pods across nodes to prevent disruption in the event of node failures, patches, or upgrades.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-upgrade-expectations"><a class="link" href="#cnf-best-practices-upgrade-expectations">3.8.1.7.8. Upgrade expectations</a></h6>
<div class="ulist">
<ul>
<li>
<p>The Kubernetes API deprecation policy defined in <a href="https://kubernetes.io/docs/reference/using-api/deprecation-policy/">Kubernetes Deprecation Policy</a> shall be followed.</p>
</li>
<li>
<p>CNFs are expected to maintain service continuity during platform upgrades, and during CNF version upgrades</p>
</li>
<li>
<p>CNFs need to be prepared for nodes to reboot or shut down without notice</p>
</li>
<li>
<p>CNFs shall configure pod disruption budget appropriately to maintain service continuity during platform upgrades</p>
</li>
<li>
<p>Applications should not be tied to a specific version of Kubernetes or any of its components</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Applications MUST specify a pod disruption budget appropriately to maintain service continuity during platform upgrades. The budget should be defined with a balance such that it allows operational flexibility for the cluster to drain nodes, but restrictive enough so that the service is not degraded over upgrades.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Pods that perform the same microservice and that could be disrupted if multiple members of the service are
unavailable must implement pod disruption budgets to prevent disruption in the event of patches/upgrades.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-taints-and-tolerations"><a class="link" href="#cnf-best-practices-taints-and-tolerations">3.8.1.7.9. Taints and tolerations</a></h6>
<div class="paragraph">
<p>Taints and tolerations allow the node to control which pods are scheduled on the node. A taint allows a node to refuse a pod to be scheduled unless that pod has a matching toleration.</p>
</div>
<div class="paragraph">
<p>You apply taints to a node through the node specification (<code>NodeSpec</code>) and apply tolerations to a pod through the pod specification (<code>PodSpec</code>). A taint on a node instructs the node to repel all pods that do not tolerate the taint.</p>
</div>
<div class="paragraph">
<p>Taints and tolerations consist of a key, value, and effect. An operator allows you to leave one of these parameters empty.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.openshift.com/container-platform/latest/nodes/scheduling/nodes-scheduler-taints-tolerations.html">Controlling pod placement using node taints</a> for more information.</p>
</div>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-requests/limits"><a class="link" href="#cnf-best-practices-requests/limits">3.8.1.7.10. Requests/Limits</a></h6>
<div class="paragraph">
<p>Requests and limits provide a way for a CNF developer to ensure they have adequate resources available to run the application. Requests can be made for storage, memory, CPU and so on. These requests and limits can be enforced by quotas. Quotas can be used as a way to enforce requests and limits. See <a href="https://docs.openshift.com/container-platform/latest/applications/quotas/quotas-setting-per-project.html">Resource quotas per project</a> for more information.</p>
</div>
<div class="paragraph">
<p>Nodes can be overcommitted which can affect the strategy of request/limit implementation. For example, when you need guaranteed capacity, use quotas to enforce. In a development environment, you can overcommit where a trade-off of guaranteed performance for capacity is acceptable. Overcommitment can be done on a project, node or cluster level.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.openshift.com/container-platform/latest/nodes/clusters/nodes-cluster-overcommit.html">Configuring your cluster to place pods on overcommitted nodes</a> for more information.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Pods must define requests and limits values for CPU and memory.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-requests-and-limits">access-control-requests-and-limits</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-use-imagepullpolicy-if-not-present"><a class="link" href="#cnf-best-practices-use-imagepullpolicy-if-not-present">3.8.1.7.11. Use imagePullPolicy: IfNotPresent</a></h6>
<div class="paragraph">
<p>If there is a situation where the container dies and needs to be restarted, the image pull policy becomes important. There are three image pull policies available: <code>Always</code>, <code>Never</code> and <code>IfNotPresent</code>. It is generally recommended to have a pull policy of <code>IfNotPresent</code>. This means that the if pod needs to restart for any reason, the kubelet will check on the node where the pod is starting and reuse the already downloaded container image if it&#8217;s available. OpenShift intentionally does not set <code>AlwaysPullImages</code> as turning on this admission plugin can introduce new kinds of cluster failure modes. Self-hosted infrastructure components are still pods: enabling this feature can result in cases where a loss of contact to an image registry can cause redeployment of an infrastructure or application pod to fail. We use <code>PullIfNotPresent</code> so that a loss of image registry access does not prevent the pod from restarting.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Container images that are protected by registry authentication have a condition whereby a user who is unable to download an image directly can still launch it by leveraging the host&#8217;s cached image.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-automount-services-for-pods"><a class="link" href="#cnf-best-practices-automount-services-for-pods">3.8.1.7.12. Automount services for pods</a></h6>
<div class="paragraph">
<p>Pods which do not require API access should set the value of <code>automountServiceAccountToken</code> to false within the pod spec, for example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">my-pod</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">serviceAccountName</span><span class="pi">:</span> <span class="s">examplesvcacct</span>
  <span class="na">automountServiceAccountToken</span><span class="pi">:</span> <span class="kc">false</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-disruption-budgets"><a class="link" href="#cnf-best-practices-disruption-budgets">3.8.1.7.13. Disruption budgets</a></h6>
<div class="paragraph">
<p>When managing the platform there are at least two types of disruptions that can occur. They are voluntary and involuntary. When dealing with voluntary disruptions a pod disruption budget can be set that determines how many replicas of the application must remain running at any given time. For example, consider the case where an administrator is shutting down a node for</p>
</div>
<div class="paragraph">
<p>maintenance and the node has to be drained. If there is a pod disruption budget set then OpenShift will respect that and ensure that the required number of pods are available by bringing up pods on different nodes before draining the current node.</p>
</div>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-no-naked-pods"><a class="link" href="#cnf-best-practices-no-naked-pods">3.8.1.7.14. No naked pods</a></h6>
<div class="paragraph">
<p>Do not use naked Pods (that is, Pods not bound to a <code>ReplicaSet</code>, or <code>StatefulSet</code> deployment). Naked pods will not be rescheduled in the event of a node failure.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Applications must not depend on any single pod being online for their application to function.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Pods must be deployed as part of a <code>Deployment</code> or <code>StatefulSet</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Pods may not be deployed in a DaemonSet.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-image-tagging"><a class="link" href="#cnf-best-practices-image-tagging">3.8.1.7.15. Image tagging</a></h6>
<div class="paragraph">
<p>An image tag is a label applied to a container image in a repository that distinguishes a specific image from other images. Image tags may be used to categorize images (for example: latest, stable, development) and by versions within the categories. This allows the administrator to be specific when declaring which image to test, or which image to run in production.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.openshift.com/container-platform/4.7/openshift_images/managing_images/tagging-images.html" class="bare">https://docs.openshift.com/container-platform/4.7/openshift_images/managing_images/tagging-images.html</a></p>
</div>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-one-process-per-container"><a class="link" href="#cnf-best-practices-one-process-per-container">3.8.1.7.16. One process per container</a></h6>
<div class="paragraph">
<p>OpenShift organizes workloads into pods. Pods are the smallest unit of a workload that Kubernetes understands. Within pods, one can have one or more containers. Containers are essentially composed of the runtime that is required to launch and run a process.</p>
</div>
<div class="paragraph">
<p>Each container should run only one process. Different processes should always be split between containers, and where possible also separate into different pods. This can help in a number of ways, such as troubleshooting, upgrades and more efficient scaling.</p>
</div>
<div class="paragraph">
<p>However, OpenShift does support running multiple containers per pod. This can be useful if parts of the application need to share namespaces like networking and storage resources. Additionally, there are other models like launching init containers, sidecar containers, etc. which may justify running multiple containers in a single pod.</p>
</div>
<div class="paragraph">
<p>More information about pods can be found <a href="https://docs.openshift.com/container-platform/latest/nodes/pods/nodes-pods-using.html">Using pods</a>.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-one-process-per-container">access-control-one-process-per-container</a></p>
</div>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-init-containers"><a class="link" href="#cnf-best-practices-init-containers">3.8.1.7.17. init containers</a></h6>
<div class="paragraph">
<p>Init containers can be used for running tools / commands / or any other action that needs to be done before the actual pod is started. For example, loading a database schema, or constructing a config file from a definition passed in via configMap or secret.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.openshift.com/container-platform/4.12/nodes/containers/nodes-containers-init.html">Using init containers to perform tasks before a pod is deployed</a> for more information.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-security-rbac"><a class="link" href="#cnf-best-practices-security-rbac">3.8.1.8. Security and role-based access control</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1">Roles / RoleBindings</dt>
<dd>
<p>A <code>Role</code> represents a set of permissions within a particular namespace. E.g: A given user can list pods/services within the namespace. The <code>RoleBinding</code> is used for granting the permissions defined in a role to a user or group of users. Applications may create roles and rolebindings within their namespace, however the scope of a role will be limited to the same permissions that the creator has or less.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-pod-role-bindings">access-control-pod-role-bindings</a></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ClusterRole / ClusterRoleBinding</dt>
<dd>
<p>A <code>ClusterRole</code> represents a set of permissions at the cluster level that can be used by multiple namespaces. The <code>ClusterRoleBinding</code> is used for granting the permissions defined in a <code>ClusterRole</code> to a user or group of users at a namespace level. Applications are not permitted to install cluster roles or create cluster role bindings. This is an administrative activity done by cluster administrators. CNFs should not use cluster roles; exceptions can be granted to allow this, however this is discouraged.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See <a href="https://docs.openshift.com/container-platform/4.7/authentication/using-rbac.html">Using RBAC to define and apply permissions</a> for more information.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>CNFs may not create <code>ClusterRole</code> or <code>ClusterRoleBinding</code> CRs. Only cluster administrators should create these CRs.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-cluster-role-bindings">access-control-cluster-role-bindings</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-custom-role-to-access-application-crds"><a class="link" href="#cnf-best-practices-custom-role-to-access-application-crds">3.8.1.9. Custom role to access application CRDs</a></h5>
<div class="paragraph">
<p>If an application requires installing/deploying CRDs (Custom Resource Definitions), the application must provide a role that allows necessary permissions to create CRs within the CRDs. The custom role to access CRDs must not create any permissions to access any other API resources than the CRDs.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>If an application creates CRDs; it must supply a role to access those CRDs and no other API resources/
permissions.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-multus"><a class="link" href="#cnf-best-practices-multus">3.8.1.10. MULTUS</a></h5>
<div class="paragraph">
<p>MULTUS is a meta-CNI that allows multiple CNIs that it delegates to. This allows pods to get additional interfaces beyond <code>eth0</code> via additional CNIs. Having additional CNIs for SR-IOV and MacVLAN interfaces allow for direct routing of traffic to a pod without using the pod network via additional interfaces. This capability is being delivered for use in only corner case scenarios, it is not to be used in general for all applications. Example use cases include bandwidth requirements that necessitate SR-IOV and protocols that are unable to be supported by the load balancer. The OVN based pod network should be used for every interface that can be supported from a technical standpoint.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Unless an application has a special traffic requirement that is not supported by SPK or ovn-kubernetes CNI
the applications must use the pod network for traffic</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="https://docs.openshift.com/container-platform/latest/networking/multiple_networks/understanding-multiple-networks.html">Understanding multiple networks</a> for more information.</p>
</div>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-multus-macvlan"><a class="link" href="#cnf-best-practices-multus-macvlan">3.8.1.11. MULTUS SR-IOV / MACVLAN</a></h5>
<div class="paragraph">
<p>SR-IOV is a specification that allows a PCIe device to appear to be multiple separate physical PCIe devices. The Performance Addon component allows you to validate SR-IOV by running DPDK, SCTP and device checking tests.</p>
</div>
<div class="paragraph">
<p>SR-IOV and MACVLAN interfaces are able to be requested for protocols that do not work with the default CNI or for exceptions where a network function has not been able to move functionality onto the CNI. These are exception use cases. MULTUS interfaces will be defined by the platform operations team for the network functions which can then consume them. VLANs will be applied by the SR-IOV VF, thus the VLAN / network that the SR-IOV interface requires must be part of the request for the namespace.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://docs.openshift.com/container-platform/latest/networking/hardware_networks/about-sriov.html">About Single Root I/O Virtualization (SR-IOV) hardware networks</a>.</p>
</div>
<div class="paragraph">
<p>By configuring the SR-IOV network, CRs named <code>NetworkAttachmentDefinitions</code> are exposed by the SR-IOV Operator in the CNF namespace.</p>
</div>
<div class="paragraph">
<p>Different names will be assigned to different Network Attachment Definitions that are namespace specific. MACVLAN versus MULTUS interfaces will be named differently to distinguish the type of device assigned to them (created by configuring SR-IOV devices via the SRIOVNetworkNodePolicy CR).</p>
</div>
<div class="paragraph">
<p>From the CNF perspective, a defined set of network attachment definitions will be available in the assigned namespace to serve secondary networks for regular usage or to serve for DPDK payloads.</p>
</div>
<div class="paragraph">
<p>The SR-IOV devices are configured by the cluster admin, and they will be available in the namespace assigned to the CNF. The following command returns the list of secondary networks available in the namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc <span class="nt">-n</span> &lt;cnf_namespace&gt; get network-attachment-definitions</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-sr-iov-interface-settings"><a class="link" href="#cnf-best-practices-sr-iov-interface-settings">3.8.1.12. SR-IOV interface settings</a></h5>
<div class="paragraph">
<p>The following settings must be negotiated with the cluster administrator, for each network type available in the namespace:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The type of netdevice to be used for the VF (kernel or userspace)</p>
</li>
<li>
<p>The vlan ID to be applied to a given set of VFs available in a namespace</p>
</li>
<li>
<p>For kernel-space devices, the IP allocation is provided directly by the cluster IP assignment mechanism.</p>
</li>
<li>
<p>The option to configure the IP of a given SR-IOV interface at runtime, see <a href="https://docs.openshift.com/container-platform/4.12/networking/hardware_networks/add-pod.html">Adding a pod to an SR-IOV additional network</a>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>SR-IOV settings are enabled by the cluster administrator.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example SRIOVnetworknodepolicy</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">SRIOVnetwork.openshift.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">SRIOVNetworkNodePolicy</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">nnp-w1ens3f0grp2</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">openshift-SRIOV-network-operator</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">deviceType</span><span class="pi">:</span> <span class="s">vfio-pci</span>
  <span class="na">isRdma</span><span class="pi">:</span> <span class="kc">false</span>
  <span class="na">linkType</span><span class="pi">:</span> <span class="s">eth</span>
  <span class="na">mtu</span><span class="pi">:</span> <span class="m">9000</span>
  <span class="na">nicSelector</span><span class="pi">:</span>
    <span class="na">deviceID</span><span class="pi">:</span> <span class="s">158b</span>
    <span class="na">pfNames</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">ens3f0#50-63</span>
    <span class="na">vendor</span><span class="pi">:</span> <span class="s2">"</span><span class="s">8086"</span>
  <span class="na">nodeSelector</span><span class="pi">:</span>
    <span class="na">kubernetes.io/hostname</span><span class="pi">:</span> <span class="s">worker-3</span>
  <span class="na">numVfs</span><span class="pi">:</span> <span class="m">64</span>
  <span class="na">priority</span><span class="pi">:</span> <span class="m">99</span>
  <span class="na">resourceName</span><span class="pi">:</span> <span class="s">w1ens3f0grp2</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>SRIOVnetwork</code> CR creates the <code>network-attach-definition</code> within the target <code>networkNamespace</code>.</p>
</div>
<div id="example-1" class="listingblock">
<div class="title">Example 1: Empty IPAM</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">SRIOVnetwork.openshift.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">SRIOVNetwork</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">SRIOVnet</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">openshift-SRIOV-network-operator</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">capabilities</span><span class="pi">:</span> <span class="s1">'</span><span class="s">{</span><span class="nv"> </span><span class="s">"mac":</span><span class="nv"> </span><span class="s">true</span><span class="nv"> </span><span class="s">}'</span>
  <span class="na">ipam</span><span class="pi">:</span> <span class="s1">'</span><span class="s">{}'</span>
  <span class="na">networkNamespace</span><span class="pi">:</span> <span class="s">&lt;CNF-NAMESPACE&gt;</span>
  <span class="na">resourceName</span><span class="pi">:</span> <span class="s">w1ens3f0grp2</span>
  <span class="na">spoofChk</span><span class="pi">:</span> <span class="s2">"</span><span class="s">off"</span>
  <span class="na">trust</span><span class="pi">:</span> <span class="s2">"</span><span class="s">on"</span>
  <span class="na">vlan</span><span class="pi">:</span> <span class="s">282</span></code></pre>
</div>
</div>
<div id="example-2" class="listingblock">
<div class="title">Example 2: Whereabouts IPAM</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">SRIOVnetwork.openshift.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">SRIOVNetwork</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">SRIOVnet</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">openshift-SRIOV-network-operator</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">capabilities</span><span class="pi">:</span> <span class="s1">'</span><span class="s">{</span><span class="nv"> </span><span class="s">"mac":</span><span class="nv"> </span><span class="s">true</span><span class="nv"> </span><span class="s">}'</span>
  <span class="na">ipam</span><span class="pi">:</span> <span class="s1">'</span><span class="s">{"type":"whereabouts","range":"FD97:0EF5:45A5:4000:00D0:0403:0000:0001/64","range_star</span><span class="nv"> </span><span class="s">t":"FD97:0EF5:45A5:4000:00D0:0403:0000:0001","range_end":"FD97:0EF5:45A5:4000:00D0:0403</span><span class="nv"> </span><span class="s">:0000:0020","routes":[{"dst":"fd97:0ef5:45a5::/48","gw":"FD97:EF5:45A5:4000::1"}]}'</span>
  <span class="na">networkNamespace</span><span class="pi">:</span> <span class="s">&lt;CNF-NAMESPACE&gt;</span>
    <span class="s">resourceName</span><span class="err">:</span> <span class="s">w1ens3f0grp2</span>
    <span class="s">spoofChk</span><span class="err">:</span> <span class="s2">"</span><span class="s">off"</span>
    <span class="na">trust</span><span class="pi">:</span> <span class="s2">"</span><span class="s">on"</span>
    <span class="na">vlan</span><span class="pi">:</span> <span class="s">282</span></code></pre>
</div>
</div>
<div id="example-3" class="listingblock">
<div class="title">Example 3: Static IPAM</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">SRIOVnetwork.openshift.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">SRIOVNetwork</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">SRIOVnet</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">openshift-SRIOV-network-operator</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">capabilities</span><span class="pi">:</span> <span class="s1">'</span><span class="s">{</span><span class="nv"> </span><span class="s">"mac":</span><span class="nv"> </span><span class="s">true</span><span class="nv"> </span><span class="s">}'</span>
  <span class="na">ipam</span><span class="pi">:</span> <span class="s1">'</span><span class="s">{"type":</span><span class="nv"> </span><span class="s">"static","addresses":[{"address":"10.120.26.5/25","gateway":"10.120.26.1"}]}'</span> <span class="na">networkNamespace</span><span class="pi">:</span> <span class="s">&lt;CNF-NAMESPACE&gt;</span>
  <span class="na">resourceName</span><span class="pi">:</span> <span class="s">w1ens3f0grp2</span>
  <span class="na">spoofChk</span><span class="pi">:</span> <span class="s2">"</span><span class="s">off"</span>
  <span class="na">trust</span><span class="pi">:</span> <span class="s2">"</span><span class="s">on"</span>
  <span class="na">vlan</span><span class="pi">:</span> <span class="s">282</span></code></pre>
</div>
</div>
<div id="example-4" class="listingblock">
<div class="title">Example 4: Using Pod Annotations to attach</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">sample-pod</span>
  <span class="na">annotations: k8s.v1.cni.cncf.io/networks</span><span class="pi">:</span> <span class="pi">|-</span>
    <span class="s">[</span>
      <span class="s">{</span>
        <span class="s">"name": "net1",</span>
        <span class="s">"mac": "20:04:0f:f1:88:01",</span>
        <span class="s">"ips": ["192.168.10.1/24", "2001::1/64"]</span>
      <span class="s">}</span>
    <span class="s">]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The examples depict scenarios used within to deliver secondary network interfaces with and without IPAM to a pod.</p>
</div>
<div class="paragraph">
<p><a href="#example-1">Example 1: Empty IPAM</a> creates a network attachment definition that does not specify an IP address, <a href="#example-2">Example 2: Whereabouts IPAM</a> makes use of the static IPAM and <a href="#example-3">Example 3: Static IPAM</a> makes use of the whereabouts CNI that provides a cluster wide dhcp option.</p>
</div>
<div class="paragraph">
<p>The actual addresses used for both whereabouts and static IPAM are managed external to the cluster.</p>
</div>
<div class="paragraph">
<p>The above <code>SRIOVnetwork</code> CR will configure a network attachment definition within the CNF namespace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc get net-attach-def <span class="nt">-n</span> &lt;cnf_namespace&gt;
<span class="go">NAME       AGE
SRIOVnet   9d</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Within the CNF namespace the SR-IOV resource is consumed via a pod annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">k8s.v1.cni.cncf.io/networks</span><span class="pi">:</span> <span class="s">SRIOVnet</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-attaching-the-vf-to-a-pod"><a class="link" href="#cnf-best-practices-attaching-the-vf-to-a-pod">3.8.1.13. Attaching the VF to a pod</a></h5>
<div class="paragraph">
<p>Once the right network attachment definition is found, applying the <code>k8s.v1.cni.cncf.io/networks</code> annotation with the name of the network attachment definition to the pod will add the additional network interfaces in the pod namespace, as per the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">sample-pod</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">k8s.v1.cni.cncf.io/networks</span><span class="pi">:</span> <span class="pi">|-</span>
      <span class="s">[</span>
        <span class="s">{</span>
          <span class="s">"name": "net1",</span>
          <span class="s">"mac": "20:04:0f:f1:88:01",</span>
          <span class="s">"ips": ["192.168.10.1/24", "2001::1/64"]</span>
         <span class="s">}</span>
      <span class="s">]</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-discovering-sr-iov-devices-properties-from-the-application"><a class="link" href="#cnf-best-practices-discovering-sr-iov-devices-properties-from-the-application">3.8.1.14. Discovering SR-IOV devices properties from the application</a></h5>
<div class="paragraph">
<p>All the properties of the interfaces are added to the pod&#8217;s <code>k8s.v1.cni.cncf.io/network-status</code> annotation. The annotation is json-formatted and for each network object contains information such as IPs (where available), MAC address, PCI address. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">k8s.v1.cni.cncf.io/network-status</span><span class="pi">:</span> <span class="pi">|-</span>
  <span class="s">[{</span>
      <span class="s">"name": "",</span>
      <span class="s">"interface": "eth0",</span>
      <span class="s">"ips": [</span>
        <span class="s">"10.132.3.148"</span>
        <span class="s">],</span>
      <span class="s">"mac": "0a:58:0a:84:03:94",</span>
      <span class="s">"default": true,</span>
      <span class="s">"dns": {}</span>
   <span class="s">}]</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>the IP information is not available if the driver specified is <code>vf-io</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The same annotation is available as a file content inside the pod, at the <code>/etc/podnetinfo/annotations</code> path. A convenience library is available to easily consume those informations from the application (bindings in C and Go).</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://docs.openshift.com/container-platform/latest/networking/hardware_networks/about-sriov.html">About Single Root I/O Virtualization (SR-IOV) hardware networks</a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-numa-awareness"><a class="link" href="#cnf-best-practices-numa-awareness">3.8.1.15. NUMA awareness</a></h5>
<div class="paragraph">
<p>If the pod is using a guaranteed QoS class and the kubelet is configured with a suitable topology manager policy (restricted, single-numa node) then the VF assigned to the pod will belong to the same NUMA node as the other assigned resources (CPU and other NUMA aware devices). Please note that HugePages are currently not NUMA aware.</p>
</div>
<div class="paragraph">
<p>See <a href="#cnf-best-practices-performance-addon-operator-pao">Node Tuning Operator</a> for NUMA awareness and more information about how HugePages are turned on.</p>
</div>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-platform-upgrade"><a class="link" href="#cnf-best-practices-platform-upgrade">3.8.1.16. Platform upgrade</a></h5>
<div class="paragraph">
<p>Openshift upgrades happen as follows:</p>
</div>
<div class="paragraph">
<p>Consider this small example cluster:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="go">master-0
master-1
master-2
worker-10
worker-11
worker-12
worker-13
loadbalancer-14
loadbalancer-15</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example cluster, there are three machine config pools: masters, workers, loadbalancers. This is an example cluster configuration, there may be more machine config pools based on functionality, e.g., 10 MCPs if needed.</p>
</div>
<div class="paragraph">
<p>When the cluster is upgraded, the API server and etcD are updated first. So the master config pool will be done first. Incrementally the cluster will go through and reboot master-0, 1, 2 to bring them to the new kubernetes version. After these are updated it will cycle to the next two machine pools one at a time. Openshift will consult the maxunavilable nodes in the machine config pool spec and reboot only as many as allowed by maxunavailable.</p>
</div>
<div class="paragraph">
<p>In a cluster as small as the above, <code>maxUnavailable</code> would be set to 1, so OpenShift would reboot loadbalancer-14 and worker-10 simultaneously as they are different machineconfigpools.</p>
</div>
<div class="paragraph">
<p>Openshift will wait until worker-10 is ready before proceeding onwards to worker-11 and continue. OpenShift will in parallel wait for loadbalancer-14 to become available again before restarting loadbalancer-15.</p>
</div>
<div class="paragraph">
<p>In clusters larger than the example cluster, the <code>maxUnavailable</code> for the worker pool may be set to a large number to reboot multiple nodes in parallel to speed up deployment of the new version of OpenShift. This number will take into account the work loads on the cluster to make sure sufficient resources are left to maintain application availability.</p>
</div>
<div class="paragraph">
<p>For an application to stay healthy during this process, if they are stateful at all, they should specify a statefulset or replicatset, kubernetes by default will attempt to schedule the set members across multiple nodes to give additional resiliency. In order to prevent kubernetes from stealing too many nodes out from under an application, an application that has a minimum number of pods that need to be running must specify a pod disruption budget. Pod disruption budgets allow an application to tell kubernetes that it needs N number of pods of said microservice alive at any given time. For example, a small stateful database may need 2 out of three pods available at any given time, so that application should set a pod disruption budget with a minavailable set to a value of 2. This will allow the scheduler to know that it should not take the second pod out of a set of 3 down at any given time during the series of node reboots.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do NOT set your pod disruption budget to <code>maxUnavailable</code> &lt;number of pods in replica&gt; or minUnavailable zero, operations will change your pod disruption budget to proceed with an upgrade at the risk of your application.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A corollary to the pod disruption budget is a strong readiness and health check. A well implemented readiness check is key for surviving these upgrades in that a pod should not report itself ready to kubernetes until it is actually ready to take over the load from another pod of the example set. An example of this being implemented poorly would be for a pod to report itself ready but it is not in sync with the other DB pods in the example above. Kubernetes could see that three of the pods are "ready" and destroy a second pod and cause disruption to the DB leading to failure of the application served by said DB.</p>
</div>
<div class="paragraph">
<p>See link:<a href="https://kubernetes.io/docs/tasks/run-application/configure-pdb/">pod disruption budget reference</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">policy/v1beta1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PodDisruptionBudget</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">db-pod-disruption-budget</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">minAvailable</span><span class="pi">:</span> <span class="m">2</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">db</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>See <a href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/recommended-host-practices.html">Recommended performance and scalability practices</a>.</p>
</div>
<div class="paragraph">
<p>By default, only one machine is allowed to be unavailable when applying the kubelet-related configuration to the available worker nodes. For a large cluster, it can take a long time for the configuration change to be reflected. At any time, you can adjust the number of machines that are updating to speed up the process.</p>
</div>
<div class="paragraph">
<p>Run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc edit machineconfigpool worker</code></pre>
</div>
</div>
<div class="paragraph">
<p>Set <code>maxUnavailable</code> to the desired value.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">spec</span><span class="pi">:</span>
  <span class="na">maxUnavailable</span><span class="pi">:</span> <span class="s">&lt;node_count&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-openshift-virtualization-kubevirt"><a class="link" href="#cnf-best-practices-openshift-virtualization-kubevirt">3.8.1.17. OpenShift virtualization and CNV best practices</a></h5>
<div class="paragraph">
<p>OpenShift Virtualization is generally-available for enterprise workloads, such throughput- and latency-insensitive workloads that may be added to the cluster. VNFs and other throughput or latency-sensitive applications can be considered only after careful validation.</p>
</div>
<div class="paragraph">
<p>OpenShift Virtualization should be installed according to its documentation, and only documented supported features may be used unless an explicit exception has been granted. See <a href="https://docs.openshift.com/container-platform/latest/virt/about-virt.html">About OpenShift Virtualization</a>.</p>
</div>
<div class="paragraph">
<p>In order to improve overall virtualization performance and reduce CPU latency, critical VNFs can take advantage of OpenShift Virtualization&#8217;s high-performance features. These can provide the VNFs with the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/virt/virtual_machines/advanced_vm_management/virt-dedicated-resources-vm.html">Dedicated resources for virtual machines</a></p>
</li>
<li>
<p><a href="https://kubevirt.io/user-guide/virtual_machines/dedicated_cpu_resources/#requesting-dedicated-cpu-for-qemu-emulator">Dedicated CPU for QEMU emulators</a></p>
</li>
<li>
<p><a href="https://kubevirt.io/user-guide/virtual_machines/disks_and_volumes/#iothreads-with-qemu-emulator-thread-and-dedicated-pinned-cpus">A separate physical CPU</a> so as to not affect the CPU latency for workloads.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Similar to OpenStack, OpenShift Virtualization supports the <a href="https://kubevirt.io/user-guide/virtual_machines/startup_scripts/#device-role-tagging">device role tagging mechanism</a> for the network interfaces (same format as it is in OSP). Users will be able to tag Network interfaces in the API and identify them in device metadata provided to the guest OS via the config drive.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-vm-image-import-recommendations-cdi"><a class="link" href="#cnf-best-practices-vm-image-import-recommendations-cdi">3.8.1.17.1. VM image import recommendations (CDI)</a></h6>
<div class="paragraph">
<p>OpenShift Virtualization VMs store their persistent disks on kubernetes Persistent Volumes (<code>PV</code>). PVs are requested by VMs using kubernetes Persistent Volume Claims (<code>PVC</code>). VMs may require a combination of blank and pre-populated disks in order to function.</p>
</div>
<div class="paragraph">
<p>Blank disks can be initialized automatically by kubevirt when an empty PV is initially encountered by a starting VM. Other disks must be populated prior to starting the VM. OpenShift Virtualization provides a component called the Containerized Data Importer (CDI) which automates the preparation of pre-populated persistent disks for VMs. CDI integrates with KubeVirt to synchronize VM creation and deletion with disk preparation by using a custom resource called a DataVolume. Using DataVolumes, data can be imported into a PV from various sources including container registries and HTTP servers.</p>
</div>
<div class="paragraph">
<p>The following recommendations should be followed when managing persistent disks for VMs:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Blank disks</dt>
<dd>
<p>Create a PVC and associate it with the VM using a persistentVolumeClaim volume type in the volumes section of the VirtualMachine spec.</p>
</dd>
<dt class="hdlist1">Populated disks</dt>
<dd>
<p>In the VirtualMachine spec, add a DataVolume to the dataVolumeTemplates section and always use the dataVolume volume type in the volumes section.</p>
</dd>
</dl>
</div>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-working-with-large-vm-disk-images"><a class="link" href="#cnf-best-practices-working-with-large-vm-disk-images">3.8.1.17.2. Working with large VM disk images</a></h6>
<div class="paragraph">
<p>In contrast to container images, VM disk images can be quite large (30GiB or more is common). It is important to consider the costs of transferring large amounts of data when planning workflows involving the creation of VMs (especially when scaling up the number of VMs). The efficiency of an image import depends on the format of the file and also the transfer method used. The most efficient workflow, for two reasons, is to host a gzip-compressed raw image on a server and import via HTTP. Compression avoids transferring zeros present in the free space of the image, and CDI can stream the contents directly into the target PV without any intermediate conversion steps. In contrast, images imported from a container registry must be transferred, unarchived, and converted prior to being usable. These additional steps increase the amount of data transferred between a node and the remote storage.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-operator-best-practices"><a class="link" href="#cnf-best-practices-operator-best-practices">3.8.1.18. Operator best practices</a></h5>
<div class="paragraph">
<p>OLM Packaged operators contain an index of all the images required to install the operator, and the <code>ClusterServiceVersion</code> which instructs OpenShift to create resources as described in the cluster service version. The cluster service version is a list of the required resources that need to be created in the cluster, i.e. service accounts, crds, roles, etc that are necessary for the operator and software that the operator installs to be successful within the cluster.</p>
</div>
<div class="paragraph">
<p>The OLM Packaged operator will then run in openshift-operators namespace within the cluster. Users can then utilize this operator by creating CRs within the CRDs that were created by the operator OLM package, to deploy the software managed by the operator. The platform administrator handles the OLM based operator installation for the users by creating a custom catalog in the cluster that is targeted by the application. The users then express via CRs that are consumed by the operator what they would like the operator to create in the users namespace.</p>
</div>
<div class="sect5">
<h6 id="cnf-best-practices-cnf-operator-requirements"><a class="link" href="#cnf-best-practices-cnf-operator-requirements">3.8.1.18.1. CNF Operator requirements</a></h6>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Operators should be certified against the openshift version of the cluster they will be deployed on.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>See Redhat Certification Documentation: Product Documentation for Red Hat Software Certification 8.56</p>
</li>
<li>
<p>Redhat SDK Bundle for certification: operator-sdk bundle validate</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Operators must be compatible with our version of openshift</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Operators must be in OLM bundle format (Operator Framework).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Must be able to function without the use of openshift routes or ingress objects.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>All custom resources for operators require podspecs for both pod image override as well pod quotas.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Operators must not use daemonsets</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>The OLM operator CSV must support the "all namespaces" install method if the operator is upstream software. If the operator is a proprietary cnf operator it must support single namespaced installation. It is recommended for an operator to support all OLM install modes to ensure flexibility in our environment.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>The operator must default to watch all namespaces if the target namespace is left NULL or empty string as this is how the OLM global-operators operator group functions.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>All operator and operand images must be referenced using digest image tags "@sha256". Openshift "imagecontentsourcepolicy" objects (ICSP) only support mirror-by-digest at this time.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>For general third party upstream operators (example: mongodb), the OLM package is recommended to be located within the Red Hat registries below to support our image mirror policy:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>quay.io</code></p>
</li>
<li>
<p><code>registry.redhat.io</code></p>
</li>
<li>
<p><code>registry.connect.redhat.com</code></p>
</li>
<li>
<p><code>registry.access.redhat.com</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Operators that are proprietary to a cnf application must ensure that their CRD&#8217;s are unique, and will not conflict with other operators in the cluster.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>If a cnf application requires a specific version of a third party non-proprietary operator for their app to function they will need to re-package the upstream third party operator and modify the api&#8217;s so that it will not conflict with the globally installed operator version.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Successful operator installation and runtime must be validated in pre-deployment lab environments before being allowed to be deployed to production.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>All required RBAC must be included in the OLM operator bundle so that it&#8217;s managed by OLM.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>It is not recommended for a cnf application to share a proprietary operator with another cnf application if that application does not share the same version lifecycle. If a cnf application does share an operator the CRDs must be backwards compatible.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-requirements-cnf-reqs"><a class="link" href="#cnf-best-practices-requirements-cnf-reqs">3.9. Requirements for CNF</a></h3>
<div class="ulist">
<ul>
<li>
<p>The application MUST declare all listening ports as containerPorts in the Pod specification it provides to Kubernetes.</p>
</li>
<li>
<p>The application MUST NOT listen on any other ports that are undeclared.</p>
<div class="ulist">
<ul>
<li>
<p>Listening ports MUST be named in the pod specification with the protocol they Implement.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#networking-undeclared-container-ports-usage">networking-undeclared-container-ports-usage</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The name field in the ContainerPort section must be of the form <code>&lt;protocol&gt;</code> where <code>&lt;protocol&gt;</code> is one of the below, and the optional <code>&lt;suffix&gt;</code> can be chosen by the application.</p>
</li>
<li>
<p>Preferred prefixes: <code>grpc</code>, <code>grpc-web</code>, <code>http</code>, <code>http2</code></p>
</li>
<li>
<p>Fallback prefixes: <code>tcp</code>, <code>udp</code></p>
</li>
<li>
<p>Valid example: <code>http-webapi</code> or <code>grpc</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#manageability-container-port-name-format">manageability-container-port-name-format</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The application MUST communicate with Kubernetes Services by their service IP instead of selecting Pods in that service individually.</p>
</li>
<li>
<p>The application MUST NOT encrypt outbound traffic on the cluster network interface.</p>
</li>
<li>
<p>The application MUST NOT decrypt inbound traffic on the cluster network interface.</p>
</li>
<li>
<p>The application SHOULD NOT manage certificates related to communication over the cluster network interface.</p>
</li>
<li>
<p>The application MUST NOT provide nftables or iptables rules.</p>
</li>
<li>
<p>The application MUST NOT define Kubernetes Custom Resources in <code>*.istio.io</code> or <code>\*.aspenmesh.io</code> namespaces.</p>
</li>
<li>
<p>The application MUST NOT define Kubernetes resources in the istio-system namespace.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-namespace">access-control-namespace</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The application MUST propagate tracing headers when making outgoing requests based on incoming requests.</p>
</li>
<li>
<p>Example: If an application receives a request with a trace header identifying that request with traceid <code>785a908c8d93b2d2</code> , and decides based on application logic that it must make a new request to another application pod to fulfill that request, it must annotate the new request with the same traceid <code>785a908c8d93b2d2</code>.</p>
</li>
<li>
<p>The application MUST propagate all of these tracing headers if present: <code>x-request-id</code>, <code>x-b3-traceid</code>, <code>x-b3-spanId</code>, <code>x-b3-parentspanid</code>, <code>x-b3-sampled</code>, <code>x-b3-flags</code>, <code>b3</code>.</p>
</li>
<li>
<p>The application MUST propagate the tracing headers by copying any header value from the original request to the new request.</p>
</li>
<li>
<p>The application SHOULD NOT modify any of these header values unless it understands the format of the headers and wishes to enhance them (e.g. implements OpenTracing)</p>
</li>
<li>
<p>If some or none of the headers are present, the application <strong>SHOULD NOT</strong> create them.</p>
</li>
<li>
<p>If an application makes a new request and it is not in service of exactly one incoming request, it MAY omit all tracing headers.</p>
<div class="ulist">
<ul>
<li>
<p>The application does not have to generate headers in this case. It could generate headers if it implements e.g. OpenTracin.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-image-standards"><a class="link" href="#cnf-best-practices-image-standards">3.9.1. Image standards</a></h4>
<div class="paragraph">
<p>It is recommended that container images be built utilizing Red Hat&#8217;s Universal Base Image as they will have a solid security baseline as well as support from Red Hat.</p>
</div>
<div class="paragraph">
<p>Vendors must satisfy 3 requirements related to maintaining proper workload isolation in a containerized environment:</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Containerized workloads must work with Red Hat&#8217;s restricted SCC1.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Containerized workloads must work with Red Hats default SELinux context. This is meant to forbid all changes to both primary config files (SCC, SEL) and the many related files referenced by these primary files. All security configuration files must be unchanged from the vendors released version.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>The container image must be secure.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Red Hat UBI is able to meet these requirements and enables images built with it to meet these requirements. UBI is supported by a dedicated, full-time team providing releases of base image. UBI has the following features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Scheduled release every 6 weeks to pick up less critical fixes.</p>
</li>
<li>
<p>On-demand release for critical or important CVE within 5 days of CVE public release.</p>
</li>
<li>
<p>Guarantees alignment with host OS packages and versions that run tightly coupled to the container artifacts. Many CVEs and potential attacks result from mismatch of untested versions of utility functions.</p>
</li>
<li>
<p>Ensures globally consistent time zone usage and resulting timestamps for global operators.</p>
</li>
<li>
<p>Enables continuous authorization to operate (ATO). Authorize once, use many times.</p>
</li>
<li>
<p>Meets requirements of the DOD, for example Air Force/DISA STIG.</p>
</li>
<li>
<p>Supports system-wide crypto consistency, for example, must have same crypto implementation as the Red Hat host operating system.</p>
</li>
<li>
<p>Provides authentication of the base layer via digital signature from originating vendor and strong signature authority.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-universal-base-image-information"><a class="link" href="#cnf-best-practices-universal-base-image-information">3.9.2. Universal Base Image information</a></h4>
<div class="paragraph">
<p><a href="https://developers.redhat.com/products/rhel/ubi">UBI</a> is designed to be a foundation for cloud-native and web applications use cases developed in containers. You can build a containerized application using UBI, push it to your choice of registry server, easily share it with others - and because its freely redistributable  even deploy it on non-Red Hat platforms. And since its built on Red Hat Enterprise Linux, UBI is a platform that is reliable, secure, and performant.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Base Images</dt>
<dd>
<p>A set of three base images (Minimal, Standard, and Multi-service) are provided to provide optimum starting points for a variety of use cases.</p>
</dd>
<dt class="hdlist1">Runtime Languages</dt>
<dd>
<p>A set of language runtime images (PHP, Perl, Python, Ruby, Node.js) enable developers to start coding out of the gate with the confidence that a Red Hat built container image provides.</p>
</dd>
<dt class="hdlist1">Complementary packages</dt>
<dd>
<p>A set of associated YUM repositories/channels include RPM packages and updates that allow users to add application dependencies and rebuild UBI container images anytime they want.</p>
<div class="paragraph">
<p>Red Hat UBI images are the preferred images to build VNFs on as they will leverage the fully supported Red Hat ecosystem. In addition, once a VNF is standardized on a Red Hat UBI, the image can become Red Hat certified.</p>
</div>
<div class="paragraph">
<p>Red Hat UBI images are free to vendors so there is a low barrier of entry to getting started.</p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-application-dns-configuration-requirements"><a class="link" href="#cnf-best-practices-application-dns-configuration-requirements">3.9.3. Application DNS configuration requirements</a></h4>
<div class="paragraph">
<p>CNFs should use the service name only as a configuration parameter for attaching to a service within your namespace, the cluster will append namespace name and kubernetes service nomenclature on behalf of the application via search string in DNS. This allows a generic name for a service that works in all clusters no matter what the namespace name is and what the cluster base FQDN is.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service">Kubernetes upstream reference for pod/service names and DNS</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cnf-best-practices-copyright"><a class="link" href="#cnf-best-practices-copyright">Copyright</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p> Copyright 2023 Red Hat Inc.</p>
</div>
<div class="paragraph">
<p>All Rights Reserved.</p>
</div>
<div class="paragraph">
<p>Information contained herein is provided AS IS and subject to change without notice.
All trademarks used herein are property of their respective owners.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version v2<br>
Last updated 2023-06-14 05:10:29 UTC
</div>
</div>
<!-- Nav bar -->
<script type="text/javascript">
const navbar = document.querySelector('.navbar');

let currentPosition = window.scrollY;

// Show navbar on page load
window.addEventListener("load", (event) => {
    navbar.classList.add('show');
});

// Show/hide navbar on scroll
window.addEventListener('scroll', () => {
    if (window.scrollY < currentPosition) {
        //scroll up
        navbar.classList.remove('show');
    } else {
        //scroll down
        navbar.classList.add('show');
    }
    currentPosition = window.scrollY;
});

// Hide navbar on click event
document.querySelectorAll('*')
    .forEach(element => element.addEventListener('click', event => {
        currentPosition = window.scrollY;
        navbar.classList.remove('show');
    }))
</script>

<!-- Copy code -->
<script type="text/javascript">
const copyButtonLabel = "Copy";

let blocks = document.querySelectorAll("pre");

blocks.forEach((block) => {
    // Only add button if browser supports Clipboard API
    if (navigator.clipboard) {
        let button = document.createElement("button");

        button.innerText = copyButtonLabel;
        block.appendChild(button);

        button.addEventListener("click", async () => {
            await copyCode(block, button);
        });
    }
});

async function copyCode(block, button) {
    let code = block.querySelector("code");
    let text = code.innerText;

    await navigator.clipboard.writeText(text);

    button.innerText = "Copied!";

    setTimeout(() => {
        button.innerText = copyButtonLabel;
    }, 400);
}
</script>

<!-- Highlight active TOC item -->
<script type="text/javascript">
const anchors = $('body').find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]');

$(window).scroll(function(){
    var scrollTop = $(document).scrollTop();

    // highlight the last scrolled-to: set everything inactive first
    for (var i = 0; i < anchors.length; i++){
            $('#toc.toc2 a[href="#' + $(anchors[i]).attr('id') + '"]').removeClass('active');
    }

    // then iterate backwards, on the first match highlight it and break
    for (var i = anchors.length-1; i >= 0; i--){
        if (scrollTop > $(anchors[i]).offset().top - 75) {
            $('#toc.toc2 a[href="#' + $(anchors[i]).attr('id') + '"]').addClass('active');
            break;
        }
    }
});
</script>
</body>
</html>